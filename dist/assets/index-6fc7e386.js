import{d as e,Q as a,r as l,b as t,U as s,c as o,Z as u,w as d,f as i,g as n,j as p,t as r,e as c,A as m,F as f,h as g,l as v,E as h,aN as y,aO as _,n as b,m as V,aP as w,C as S,s as k,q as U,aQ as C,aR as I,_ as A,aS as D,o as x,aw as z,aF as N,aT as T,v as E,x as P,aU as j,aV as K,aW as W,aX as q}from"./index-55d4e470.js";import{E as B,a as R,b as O,v as $}from"./table-column-74891efb.js";import{E as F}from"./card-9d3b4924.js";import{E as L}from"./overlay-2f412c5d.js";const Q={class:"secret-input-wrapper"},X={class:"dialog-footer"},Z=A(e({__name:"WechatConfigDialog",props:{modelValue:{type:Boolean},configData:{default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(e,{emit:A}){const D=e,x=A,z=a({get:()=>D.modelValue,set:e=>x("update:modelValue",e)}),N=l(),T=l(!1),E=l([]),P=t({appType:3,corpId:"",boundDomain:"",appId:"",appName:"",appSecret:""}),j={appType:[{required:!0,message:"请选择应用类型",trigger:"change"}],corpId:[{required:!0,message:"请输入企业微信Id",trigger:"blur"}],boundDomain:[{required:!0,message:"请选择绑定域名",trigger:"change"}],appId:[{required:!0,message:"请输入应用Id",trigger:"blur"}],appName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],appSecret:[{required:!0,message:"请输入应用秘钥",trigger:"blur"}]};s((()=>D.configData),(e=>{e&&Object.assign(P,{appType:e.appType||3,corpId:e.corpId||"",boundDomain:e.boundDomain||"",appId:e.appId||"",appName:e.appName||"",appSecret:e.appSecret||""})}),{immediate:!0}),s((()=>D.modelValue),(e=>{e&&q()}));const K=()=>{z.value=!1,W()},W=()=>{var e;Object.assign(P,{appType:3,corpId:"",boundDomain:"",appId:"",appName:"",appSecret:""}),null==(e=N.value)||e.clearValidate()},q=async()=>{try{const e=await v.getAllTenantDomains();e&&e.data?E.value=e.data:Array.isArray(e)&&(E.value=e)}catch(e){h.error("加载域名列表失败")}},B=()=>{h.info("应用秘钥可在企业微信管理后台的应用详情中获取")},R=async()=>{if(N.value)try{await N.value.validate(),T.value=!0,D.isEdit?(await v.updateWechatConfig(D.configData.id,P),h.success("修改成功")):(await v.createWechatConfig(P),h.success("添加成功")),x("success"),K()}catch(e){h.error(e.message||"操作失败")}finally{T.value=!1}};return(e,a)=>{const l=y,t=_,s=b,v=V,h=I,A=w,D=S,x=k,W=U,O=L;return o(),u(O,{modelValue:z.value,"onUpdate:modelValue":a[6]||(a[6]=e=>z.value=e),title:e.isEdit?"修改企业微信配置":"新建企业微信配置",width:"600px","close-on-click-modal":!1,"z-index":2e3,onClose:K},{footer:d((()=>[i("div",X,[n(W,{onClick:K},{default:d((()=>[p("取消")])),_:1}),n(W,{type:"primary",loading:T.value,onClick:R},{default:d((()=>[p(r(e.isEdit?"确定保存":"确定添加"),1)])),_:1},8,["loading"])])])),default:d((()=>[n(x,{ref_key:"formRef",ref:N,model:P,rules:j,"label-width":"200px"},{default:d((()=>[n(s,{label:"应用类型",prop:"appType"},{default:d((()=>[n(t,{modelValue:P.appType,"onUpdate:modelValue":a[0]||(a[0]=e=>P.appType=e),class:"app-type-radio-group"},{default:d((()=>[n(l,{value:1,class:"app-type-radio"},{default:d((()=>[p("通讯录应用")])),_:1}),n(l,{value:2,class:"app-type-radio"},{default:d((()=>[p("自建业务应用")])),_:1}),n(l,{value:3,class:"app-type-radio"},{default:d((()=>[p("代开发应用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),n(s,{label:"企业微信Id",prop:"corpId"},{default:d((()=>[n(v,{modelValue:P.corpId,"onUpdate:modelValue":a[1]||(a[1]=e=>P.corpId=e),placeholder:"请设置企业微信Id",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),n(s,{label:"绑定域名",prop:"boundDomain"},{default:d((()=>[n(A,{modelValue:P.boundDomain,"onUpdate:modelValue":a[2]||(a[2]=e=>P.boundDomain=e),placeholder:"请选择绑定域名",filterable:"",clearable:"",style:{width:"100%"},class:"form-select",onFocus:q},{default:d((()=>[(o(!0),c(f,null,m(E.value,(e=>(o(),u(h,{key:e.id,label:`${e.protocol}://${e.domainName}`,value:e.domainName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(s,{label:"应用Id(AgentId)",prop:"appId",class:"app-id-form-item"},{default:d((()=>[n(v,{modelValue:P.appId,"onUpdate:modelValue":a[3]||(a[3]=e=>P.appId=e),placeholder:"请设置应用Id",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),n(s,{label:"应用名称",prop:"appName"},{default:d((()=>[n(v,{modelValue:P.appName,"onUpdate:modelValue":a[4]||(a[4]=e=>P.appName=e),placeholder:"请设置应用名称",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),n(s,{label:"应用秘钥(Secret)",prop:"appSecret",class:"app-secret-form-item"},{default:d((()=>[i("div",Q,[n(v,{modelValue:P.appSecret,"onUpdate:modelValue":a[5]||(a[5]=e=>P.appSecret=e),placeholder:"请设置应用秘钥",clearable:"","show-password":"",class:"form-input secret-input"},null,8,["modelValue"]),n(D,{class:"help-icon",onClick:B},{default:d((()=>[n(g(C))])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-1164cc93"]]),G={class:"dialog-footer"},H=A(e({__name:"ConfigParamsDialog",props:{modelValue:{type:Boolean},configData:{default:null}},emits:["update:modelValue","success"],setup(e,{emit:r}){const c=e,m=r,f=a({get:()=>c.modelValue,set:e=>m("update:modelValue",e)}),g=l(),y=l(!1),_=t({messagePushUrl:"",token:"",encodingAesKey:"",verificationStatus:0,hrAuthStatus:0}),w={messagePushUrl:[{type:"url",message:"请输入正确的URL格式",trigger:"blur"}]};s((()=>c.configData),(e=>{e&&Object.assign(_,{messagePushUrl:e.messagePushUrl||"",token:e.token||"",encodingAesKey:e.encodingAesKey||"",verificationStatus:e.verificationStatus||0,hrAuthStatus:e.hrAuthStatus||0})}),{immediate:!0});const S=()=>{f.value=!1,C()},C=()=>{var e;Object.assign(_,{messagePushUrl:"",token:"",encodingAesKey:"",verificationStatus:0,hrAuthStatus:0}),null==(e=g.value)||e.clearValidate()},I=async()=>{if(g.value)try{await g.value.validate(),y.value=!0,await v.updateWechatConfig(c.configData.id,_),h.success("配置保存成功"),m("success"),S()}catch(e){h.error(e.message||"保存配置失败")}finally{y.value=!1}};return(e,a)=>{const l=V,t=b,s=D,r=k,c=U,m=L;return o(),u(m,{modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),title:"配置参数",width:"500px","close-on-click-modal":!1,"z-index":2e3,onClose:S},{footer:d((()=>[i("div",G,[n(c,{onClick:S},{default:d((()=>[p("取消")])),_:1}),n(c,{type:"primary",loading:y.value,onClick:I},{default:d((()=>[p(" 确定保存 ")])),_:1},8,["loading"])])])),default:d((()=>[n(r,{ref_key:"formRef",ref:g,model:_,rules:w,"label-width":"120px"},{default:d((()=>[n(t,{label:"消息推送URL",prop:"messagePushUrl"},{default:d((()=>[n(l,{modelValue:_.messagePushUrl,"onUpdate:modelValue":a[0]||(a[0]=e=>_.messagePushUrl=e),placeholder:"请输入消息推送URL",clearable:""},null,8,["modelValue"])])),_:1}),n(t,{label:"Token",prop:"token"},{default:d((()=>[n(l,{modelValue:_.token,"onUpdate:modelValue":a[1]||(a[1]=e=>_.token=e),placeholder:"请输入Token",clearable:""},null,8,["modelValue"])])),_:1}),n(t,{label:"EncodingAESKey",prop:"encodingAesKey"},{default:d((()=>[n(l,{modelValue:_.encodingAesKey,"onUpdate:modelValue":a[2]||(a[2]=e=>_.encodingAesKey=e),placeholder:"请输入EncodingAESKey",clearable:""},null,8,["modelValue"])])),_:1}),n(t,{label:"验证状态",prop:"verificationStatus"},{default:d((()=>[n(s,{modelValue:_.verificationStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>_.verificationStatus=e),"active-value":1,"inactive-value":0,"active-text":"已验证","inactive-text":"未验证"},null,8,["modelValue"])])),_:1}),n(t,{label:"人力资源授权",prop:"hrAuthStatus"},{default:d((()=>[n(s,{modelValue:_.hrAuthStatus,"onUpdate:modelValue":a[4]||(a[4]=e=>_.hrAuthStatus=e),"active-value":1,"inactive-value":0,"active-text":"已授权","inactive-text":"未授权"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-0cb95356"]]),J={class:"access-config"},M={class:"page-header"},Y=(e=>(E("data-v-559de036"),e=e(),P(),e))((()=>i("div",{class:"header-content"},[i("h2",{class:"page-title"},"接入配置"),i("p",{class:"page-subtitle"},"企业微信的接入配置信息管理")],-1))),ee={class:"header-actions"},ae={class:"search-section"},le={class:"action-section"},te={class:"table-section"},se={class:"pagination-section"},oe=A(e({__name:"index",setup(e){const a=t({systemDefault:"",appName:""}),s=l([]),m=l([]),f=l(!1),y=t({page:1,limit:20,total:0}),_=l(!1),w=l(null),C=l(!1),I=l(!1),A=async()=>{try{f.value=!0;const e={page:y.page,limit:y.limit,...a},l=await v.getWechatConfigs(e);l&&(s.value=l.list||[],y.total=l.total||0)}catch(e){h.error("获取配置列表失败")}finally{f.value=!1}},D=()=>{y.page=1,A()},E=()=>{a.systemDefault="",a.appName="",y.page=1,A()},P=e=>{m.value=e},L=()=>{w.value=null,C.value=!1,_.value=!0},Q=async()=>{try{await N.confirm(`确定要删除选中的 ${m.value.length} 个配置吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=m.value.map((e=>e.id));await v.batchDeleteWechatConfigs(e),h.success("批量删除成功"),A()}catch(e){"cancel"!==e&&h.error("批量删除失败")}},X=()=>{_.value=!1,A()},G=()=>{I.value=!1,A()},oe=e=>{y.limit=e,y.page=1,A()},ue=e=>{y.page=e,A()};return x((()=>{A()})),(e,l)=>{const t=S,x=U,de=V,ie=b,ne=k,pe=F,re=B,ce=T,me=R,fe=O,ge=$;return o(),c("div",J,[i("div",M,[Y,i("div",ee,[n(x,{type:"primary",size:"large",onClick:L,class:"add-button"},{default:d((()=>[n(t,null,{default:d((()=>[n(g(j))])),_:1}),p(" 新建企业微信配置 ")])),_:1})])]),i("div",ae,[n(pe,{class:"search-card"},{default:d((()=>[n(ne,{model:a,inline:"",class:"search-form"},{default:d((()=>[n(ie,{label:"系统默认值"},{default:d((()=>[n(de,{modelValue:a.systemDefault,"onUpdate:modelValue":l[0]||(l[0]=e=>a.systemDefault=e),placeholder:"请输入系统默认值",clearable:"",class:"search-input"},null,8,["modelValue"])])),_:1}),n(ie,{label:"应用名称"},{default:d((()=>[n(de,{modelValue:a.appName,"onUpdate:modelValue":l[1]||(l[1]=e=>a.appName=e),placeholder:"请输入应用名称",clearable:"",class:"search-input"},null,8,["modelValue"])])),_:1}),n(ie,null,{default:d((()=>[n(x,{type:"primary",onClick:D,class:"search-button"},{default:d((()=>[n(t,null,{default:d((()=>[n(g(K))])),_:1}),p(" 查询 ")])),_:1}),n(x,{onClick:E,class:"reset-button"},{default:d((()=>[n(t,null,{default:d((()=>[n(g(W))])),_:1}),p(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})]),i("div",le,[n(x,{type:"danger",disabled:0===m.value.length,onClick:Q},{default:d((()=>[n(t,null,{default:d((()=>[n(g(q))])),_:1}),p(" 批量删除 ")])),_:1},8,["disabled"]),n(x,{type:"primary",onClick:L},{default:d((()=>[n(t,null,{default:d((()=>[n(g(j))])),_:1}),p(" 添加企业微信配置 ")])),_:1})]),i("div",te,[z((o(),u(me,{data:s.value,onSelectionChange:P,stripe:"",border:"",style:{width:"100%"}},{default:d((()=>[n(re,{type:"selection",width:"55"}),n(re,{prop:"appId",label:"应用Id",width:"100"}),n(re,{prop:"appName",label:"应用名称","min-width":"150"}),n(re,{prop:"corpId",label:"企业微信Id",width:"180"}),n(re,{label:"应用秘钥",width:"100"},{default:d((({row:e})=>[n(ce,{type:"success",size:"small"},{default:d((()=>[p("已配置")])),_:1})])),_:1}),n(re,{label:"应用T...",width:"100"},{default:d((({row:e})=>[n(ce,{type:"success",size:"small"},{default:d((()=>[p("已配置")])),_:1})])),_:1}),n(re,{label:"消息推...",width:"100"},{default:d((({row:e})=>[n(ce,{type:"success",size:"small"},{default:d((()=>[p("已配置")])),_:1})])),_:1}),n(re,{label:"验证状态",width:"100"},{default:d((({row:e})=>[n(ce,{type:e.verificationStatus?"success":"warning",size:"small"},{default:d((()=>[p(r(e.verificationStatus?"已验证":"未验证"),1)])),_:2},1032,["type"])])),_:1}),n(re,{label:"人力资...",width:"100"},{default:d((({row:e})=>[n(ce,{type:e.hrAuthStatus?"success":"warning",size:"small"},{default:d((()=>[p(r(e.hrAuthStatus?"已授权":"未授权"),1)])),_:2},1032,["type"])])),_:1}),n(re,{prop:"boundDomain",label:"绑定域名","min-width":"150"}),n(re,{label:"操作",width:"200",fixed:"right"},{default:d((({row:e})=>[n(x,{type:"primary",link:"",size:"small",onClick:a=>(e=>{w.value={...e},I.value=!0})(e)},{default:d((()=>[p(" 配置参数 ")])),_:2},1032,["onClick"]),n(x,{type:"warning",link:"",size:"small",onClick:a=>(e=>{w.value={...e},C.value=!0,_.value=!0})(e)},{default:d((()=>[p(" 修改 ")])),_:2},1032,["onClick"]),n(x,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await N.confirm(`确定要删除配置 "${e.appName}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.deleteWechatConfig(e.id),h.success("删除成功"),A()}catch(a){"cancel"!==a&&h.error("删除失败")}})(e)},{default:d((()=>[p(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ge,f.value]])]),i("div",se,[n(fe,{"current-page":y.page,"onUpdate:currentPage":l[2]||(l[2]=e=>y.page=e),"page-size":y.limit,"onUpdate:pageSize":l[3]||(l[3]=e=>y.limit=e),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),n(Z,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=e=>_.value=e),"config-data":w.value,"is-edit":C.value,onSuccess:X},null,8,["modelValue","config-data","is-edit"]),n(H,{modelValue:I.value,"onUpdate:modelValue":l[5]||(l[5]=e=>I.value=e),"config-data":w.value,onSuccess:G},null,8,["modelValue","config-data"])])}}}),[["__scopeId","data-v-559de036"]]);export{oe as default};
