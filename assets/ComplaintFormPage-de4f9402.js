import{d as a,u as e,B as t,r as n,o as s,b as l,c as o,e as c,f as r,g as i,H as u,t as m,I as d,w as p,h as v,j as f,E as g,l as y,m as h,G as b,J as w,q as x,v as _,x as I,K as V,_ as j}from"./index-1c523516.js";const z=a=>(_("data-v-cad79108"),a=a(),I(),a),k={class:"complaint-form-page"},q={class:"form-container"},F={class:"form-section"},G=z((()=>r("div",{class:"form-label"}," 手机号码(必填) ",-1))),N={key:0,class:"error-message"},P={class:"form-section"},T=z((()=>r("div",{class:"form-label"}," 图片证据(选填) ",-1))),U={class:"upload-trigger"},C={class:"form-section"},R=z((()=>r("div",{class:"form-label"}," 投诉内容(必填) ",-1))),B={key:0,class:"error-message"},E={class:"mt-[20px] px-[20px]"},J=j(a({__name:"ComplaintFormPage",setup(a){const _=e(),I=t(),j=n(),z=n([]);s((()=>{document.title="举报"}));const J=l({contact:"",content:"",images:[]}),L=l({contact:"",content:""}),S=n(!1),H=n(""),K=n("");s((async()=>{H.value=I.query.violationType||"",K.value=I.query.fraudType||""}));const M=async(a,e)=>{try{const e=await $(a.raw);z.value.push(e),g.success("图片上传成功")}catch(t){g.error("图片上传失败: "+t.message);const n=e.findIndex((e=>e.uid===a.uid));n>-1&&e.splice(n,1)}},O=async(a,e)=>{var t,n;try{(null==(n=null==(t=a.response)?void 0:t.data)?void 0:n.filename)&&await A(a.response.data.filename),z.value=e,J.images=e.map((a=>{var e,t;return{file:a.raw,url:a.url||URL.createObjectURL(a.raw),filename:(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.filename)||"",originalName:a.name,size:a.size}}))}catch(s){g.error("删除文件失败")}},W=a=>{if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type))return g.error("只能上传图片文件 (JPEG, PNG, GIF, WebP)!"),!1;return a.size>5242880?(g.error("图片大小不能超过5MB!"),!1):!(J.images.length>=9)||(g.error("最多只能上传9张图片!"),!1)},$=async a=>await y.uploadSingleFile(a),A=async a=>await y.deleteFile(a),D=a=>/^1[3-9]\d{9}$/.test(a),Q=()=>{const a=J.contact.trim();L.contact="",a&&(D(a)||(L.contact="请输入正确的手机号码"))},X=async()=>{var a,e;if(!(()=>{let a=!0;return L.contact="",L.content="",J.contact.trim()?D(J.contact.trim())||(L.contact="请输入正确的手机号码",a=!1):(L.contact="请输入联系方式",a=!1),J.content.trim()?J.content.trim().length<5&&(L.content="投诉内容至少需要5个字符",a=!1):(L.content="请输入投诉内容",a=!1),a})())return;S.value=!0;const t=sessionStorage.getItem("channelId");try{const n={contact:J.contact,content:J.content,reason:I.query.reason||"",violationType:H.value,fraudType:K.value,channelId:t,images:null==(e=null==(a=z.value)?void 0:a.map)?void 0:e.call(a,(a=>({filename:a.filename,originalName:a.originalName,size:a.size,url:a.url})))};await y.submitComplaint(n);_.push("/complaint/success")}catch(n){}finally{S.value=!1}};return(a,e)=>{const t=h,n=b,s=w,l=x;return o(),c("div",k,[r("div",q,[r("div",F,[G,i(t,{modelValue:J.contact,"onUpdate:modelValue":e[0]||(e[0]=a=>J.contact=a),placeholder:"请输入手机号码",class:u(["form-input",{error:L.contact}]),onInput:Q},null,8,["modelValue","class"]),L.contact?(o(),c("div",N,m(L.contact),1)):d("",!0)]),r("div",P,[T,i(s,{ref_key:"uploadRef",ref:j,"file-list":z.value,"auto-upload":!1,"on-change":M,"on-remove":O,"before-upload":W,multiple:"","list-type":"picture-card",accept:"image/*",class:"custom-upload"},{default:p((()=>[r("div",U,[i(n,{class:"camera-icon"},{default:p((()=>[i(v(V))])),_:1})])])),_:1},8,["file-list"])]),r("div",C,[R,i(t,{modelValue:J.content,"onUpdate:modelValue":e[1]||(e[1]=a=>J.content=a),type:"textarea",rows:6,placeholder:"请详细描述投诉内容",class:u(["form-textarea",{error:L.content}])},null,8,["modelValue","class"]),L.content?(o(),c("div",B,m(L.content),1)):d("",!0)])]),r("div",E,[i(l,{type:"primary",class:"submit-button",loading:S.value,onClick:X},{default:p((()=>[f(" 提交 ")])),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-cad79108"]]);export{J as default};
