import{d as a,u as e,B as t,r as n,o as s,b as o,c as l,e as c,f as r,g as i,H as u,t as m,I as d,w as p,h as v,j as f,E as g,l as y,m as h,G as w,J as b,q as x,v as _,x as I,K as V,_ as j}from"./index-9d598a61.js";const z=a=>(_("data-v-3447a7e5"),a=a(),I(),a),k={class:"complaint-form-page"},q={class:"form-container"},F={class:"form-section"},G=z((()=>r("div",{class:"form-label"}," 联系方式(必填) ",-1))),N={key:0,class:"error-message"},P={class:"form-section"},T=z((()=>r("div",{class:"form-label"}," 图片证据(选填) ",-1))),U={class:"upload-trigger"},C={class:"form-section c1"},R={key:0,class:"error-message"},B={class:"mt-[20px] px-[20px]"},E=j(a({__name:"ComplaintFormPage",setup(a){const _=e(),I=t(),j=n(),z=n([]);s((()=>{document.title="举报"}));const E=o({contact:"",content:"",images:[]}),J=o({contact:"",content:""}),L=n(!1),S=n(""),H=n("");s((async()=>{S.value=I.query.violationType||"",H.value=I.query.fraudType||""}));const K=async(a,e)=>{try{const e=await W(a.raw);z.value.push(e),g.success("图片上传成功")}catch(t){g.error("图片上传失败: "+t.message);const n=e.findIndex((e=>e.uid===a.uid));n>-1&&e.splice(n,1)}},M=async(a,e)=>{var t,n;try{(null==(n=null==(t=a.response)?void 0:t.data)?void 0:n.filename)&&await $(a.response.data.filename),z.value=e,E.images=e.map((a=>{var e,t;return{file:a.raw,url:a.url||URL.createObjectURL(a.raw),filename:(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.filename)||"",originalName:a.name,size:a.size}}))}catch(s){g.error("删除文件失败")}},O=a=>{if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type))return g.error("只能上传图片文件 (JPEG, PNG, GIF, WebP)!"),!1;return a.size>5242880?(g.error("图片大小不能超过5MB!"),!1):!(E.images.length>=9)||(g.error("最多只能上传9张图片!"),!1)},W=async a=>await y.uploadSingleFile(a),$=async a=>await y.deleteFile(a),A=a=>/^1[3-9]\d{9}$/.test(a),D=()=>{const a=E.contact.trim();J.contact="",a&&(A(a)||(J.contact="请输入正确的手机号码"))},Q=async()=>{var a,e;if(!(()=>{let a=!0;return J.contact="",J.content="",E.contact.trim()?A(E.contact.trim())||(J.contact="请输入正确的手机号码",a=!1):(J.contact="请输入联系方式",a=!1),E.content.trim()?E.content.trim().length<5&&(J.content="投诉内容至少需要5个字符",a=!1):(J.content="请输入投诉内容",a=!1),a})())return;L.value=!0;const t=sessionStorage.getItem("channelId");try{const n={contact:E.contact,content:E.content,reason:I.query.reason||"",violationType:S.value,fraudType:H.value,channelId:t,images:null==(e=null==(a=z.value)?void 0:a.map)?void 0:e.call(a,(a=>({filename:a.filename,originalName:a.originalName,size:a.size,url:a.url})))};await y.submitComplaint(n);_.push("/complaint/success")}catch(n){}finally{L.value=!1}};return(a,e)=>{const t=h,n=w,s=b,o=x;return l(),c("div",k,[r("div",q,[r("div",F,[G,i(t,{modelValue:E.contact,"onUpdate:modelValue":e[0]||(e[0]=a=>E.contact=a),placeholder:"请输入手机号码",class:u(["form-input",{error:J.contact}]),onInput:D},null,8,["modelValue","class"]),J.contact?(l(),c("div",N,m(J.contact),1)):d("",!0)]),r("div",P,[T,i(s,{ref_key:"uploadRef",ref:j,"file-list":z.value,"auto-upload":!1,"on-change":K,"on-remove":M,"before-upload":O,multiple:"","list-type":"picture-card",accept:"image/*",class:"custom-upload"},{default:p((()=>[r("div",U,[i(n,{class:"camera-icon"},{default:p((()=>[i(v(V))])),_:1})])])),_:1},8,["file-list"])]),r("div",C,[i(t,{modelValue:E.content,"onUpdate:modelValue":e[1]||(e[1]=a=>E.content=a),type:"textarea",rows:6,placeholder:"投诉内容(必填)",class:u(["form-textarea",{error:J.content}])},null,8,["modelValue","class"]),J.content?(l(),c("div",R,m(J.content),1)):d("",!0)])]),r("div",B,[i(o,{type:"primary",class:"submit-button",loading:L.value,onClick:Q},{default:p((()=>[f(" 提交 ")])),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-3447a7e5"]]);export{E as default};
