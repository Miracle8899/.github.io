import{d as a,u as e,A as t,r as n,o as s,b as l,c as o,e as c,f as r,g as i,G as u,t as m,H as d,w as p,h as v,j as f,E as g,l as y,m as h,D as b,I as w,q as x,v as _,x as I,J as V,_ as j}from"./index-62a62fdc.js";const z=a=>(_("data-v-cad79108"),a=a(),I(),a),k={class:"complaint-form-page"},q={class:"form-container"},F={class:"form-section"},G=z((()=>r("div",{class:"form-label"}," 手机号码(必填) ",-1))),N={key:0,class:"error-message"},P={class:"form-section"},T=z((()=>r("div",{class:"form-label"}," 图片证据(选填) ",-1))),U={class:"upload-trigger"},C={class:"form-section"},R=z((()=>r("div",{class:"form-label"}," 投诉内容(必填) ",-1))),E={key:0,class:"error-message"},J={class:"mt-[20px] px-[20px]"},L=j(a({__name:"ComplaintFormPage",setup(a){const _=e(),I=t(),j=n(),z=n([]);s((()=>{document.title="举报"}));const L=l({contact:"",content:"",images:[]}),S=l({contact:"",content:""}),A=n(!1),B=n(""),D=n("");s((async()=>{B.value=I.query.violationType||"",D.value=I.query.fraudType||""}));const H=async(a,e)=>{try{const e=await W(a.raw);z.value.push(e),g.success("图片上传成功")}catch(t){g.error("图片上传失败: "+t.message);const n=e.findIndex((e=>e.uid===a.uid));n>-1&&e.splice(n,1)}},M=async(a,e)=>{var t,n;try{(null==(n=null==(t=a.response)?void 0:t.data)?void 0:n.filename)&&await $(a.response.data.filename),z.value=e,L.images=e.map((a=>{var e,t;return{file:a.raw,url:a.url||URL.createObjectURL(a.raw),filename:(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.filename)||"",originalName:a.name,size:a.size}}))}catch(s){g.error("删除文件失败")}},O=a=>{if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type))return g.error("只能上传图片文件 (JPEG, PNG, GIF, WebP)!"),!1;return a.size>5242880?(g.error("图片大小不能超过5MB!"),!1):!(L.images.length>=9)||(g.error("最多只能上传9张图片!"),!1)},W=async a=>await y.uploadSingleFile(a),$=async a=>await y.deleteFile(a),K=a=>/^1[3-9]\d{9}$/.test(a),Q=()=>{const a=L.contact.trim();S.contact="",a&&(K(a)||(S.contact="请输入正确的手机号码"))},X=async()=>{var a,e;if(!(()=>{let a=!0;return S.contact="",S.content="",L.contact.trim()?K(L.contact.trim())||(S.contact="请输入正确的手机号码",a=!1):(S.contact="请输入联系方式",a=!1),L.content.trim()?L.content.trim().length<5&&(S.content="投诉内容至少需要5个字符",a=!1):(S.content="请输入投诉内容",a=!1),a})())return;A.value=!0;const t=sessionStorage.getItem("channelId");try{const n={contact:L.contact,content:L.content,reason:I.query.reason||"",violationType:B.value,fraudType:D.value,channelId:t,images:null==(e=null==(a=z.value)?void 0:a.map)?void 0:e.call(a,(a=>({filename:a.filename,originalName:a.originalName,size:a.size,url:a.url})))};await y.submitComplaint(n);_.push("/complaint/success")}catch(n){}finally{A.value=!1}};return(a,e)=>{const t=h,n=b,s=w,l=x;return o(),c("div",k,[r("div",q,[r("div",F,[G,i(t,{modelValue:L.contact,"onUpdate:modelValue":e[0]||(e[0]=a=>L.contact=a),placeholder:"请输入手机号码",class:u(["form-input",{error:S.contact}]),onInput:Q},null,8,["modelValue","class"]),S.contact?(o(),c("div",N,m(S.contact),1)):d("",!0)]),r("div",P,[T,i(s,{ref_key:"uploadRef",ref:j,"file-list":z.value,"auto-upload":!1,"on-change":H,"on-remove":M,"before-upload":O,multiple:"","list-type":"picture-card",accept:"image/*",class:"custom-upload"},{default:p((()=>[r("div",U,[i(n,{class:"camera-icon"},{default:p((()=>[i(v(V))])),_:1})])])),_:1},8,["file-list"])]),r("div",C,[R,i(t,{modelValue:L.content,"onUpdate:modelValue":e[1]||(e[1]=a=>L.content=a),type:"textarea",rows:6,placeholder:"请详细描述投诉内容",class:u(["form-textarea",{error:S.content}])},null,8,["modelValue","class"]),S.content?(o(),c("div",E,m(S.content),1)):d("",!0)])]),r("div",J,[i(l,{type:"primary",class:"submit-button",loading:A.value,onClick:X},{default:p((()=>[f(" 提交 ")])),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-cad79108"]]);export{L as default};
