import{d as e,R as l,aY as a,aa as t,a8 as s,ax as i,aZ as n,a_ as r,M as o,N as u,h as d,c,e as p,f as v,F as m,C as g,$ as b,g as f,Q as h,a$ as y,ae as _,b0 as w,S as k,A as S,H as C,X as x,j as N,t as V,I as $,b1 as j,av as z,aw as E,aS as D,w as I,am as W,G as U,r as B,b as A,o as M,l as P,E as q,aB as G,m as L,aI as R,aG as T,q as F,aK as H,v as K,x as O,b2 as Q,_ as X}from"./index-1c523516.js";import{E as Y,a as Z,b as J,v as ee}from"./table-column-09edd8b4.js";import{E as le}from"./overlay-43116231.js";const ae=Symbol("elDescriptions");var te=e({name:"ElDescriptionsCell",props:{cell:{type:Object},tag:{type:String,default:"td"},type:{type:String}},setup:()=>({descriptions:l(ae,{})}),render(){var e;const l=a(this.cell),o=((null==(e=this.cell)?void 0:e.dirs)||[]).map((e=>{const{dir:l,arg:a,modifiers:t,value:s}=e;return[l,s,a,t]})),{border:u,direction:d}=this.descriptions,c="vertical"===d,p=()=>{var e,a,t;return(null==(t=null==(a=null==(e=this.cell)?void 0:e.children)?void 0:a.label)?void 0:t.call(a))||l.label},v=()=>{var e,l,a;return null==(a=null==(l=null==(e=this.cell)?void 0:e.children)?void 0:l.default)?void 0:a.call(l)},m=l.span,g=l.rowspan,b=l.align?`is-${l.align}`:"",f=l.labelAlign?`is-${l.labelAlign}`:b,h=l.className,y=l.labelClassName,_="label"===this.type&&(l.labelWidth||this.descriptions.labelWidth)||l.width,w={width:t(_),minWidth:t(l.minWidth)},k=s("descriptions");switch(this.type){case"label":return i(n(this.tag,{style:w,class:[k.e("cell"),k.e("label"),k.is("bordered-label",u),k.is("vertical-label",c),f,y],colSpan:c?m:1,rowspan:c?1:g},p()),o);case"content":return i(n(this.tag,{style:w,class:[k.e("cell"),k.e("content"),k.is("bordered-content",u),k.is("vertical-content",c),b,h],colSpan:c?m:2*m-1,rowspan:c?2*g-1:g},v()),o);default:{const e=p(),a={},s=t(l.labelWidth||this.descriptions.labelWidth);return s&&(a.width=s,a.display="inline-block"),i(n("td",{style:w,class:[k.e("cell"),b],colSpan:m,rowspan:g},[r(e)?void 0:n("span",{style:a,class:[k.e("label"),y]},e),n("span",{class:[k.e("content"),h]},v())]),o)}}}});const se=o({row:{type:u(Array),default:()=>[]}}),ie=e({name:"ElDescriptionsRow"});var ne=h(e({...ie,props:se,setup(e){const a=l(ae,{});return(e,l)=>"vertical"===d(a).direction?(c(),p(m,{key:0},[v("tr",null,[(c(!0),p(m,null,g(e.row,((e,l)=>(c(),b(d(te),{key:`tr1-${l}`,cell:e,tag:"th",type:"label"},null,8,["cell"])))),128))]),v("tr",null,[(c(!0),p(m,null,g(e.row,((e,l)=>(c(),b(d(te),{key:`tr2-${l}`,cell:e,tag:"td",type:"content"},null,8,["cell"])))),128))])],64)):(c(),p("tr",{key:1},[(c(!0),p(m,null,g(e.row,((e,l)=>(c(),p(m,{key:`tr3-${l}`},[d(a).border?(c(),p(m,{key:0},[f(d(te),{cell:e,tag:"td",type:"label"},null,8,["cell"]),f(d(te),{cell:e,tag:"td",type:"content"},null,8,["cell"])],64)):(c(),b(d(te),{key:1,cell:e,tag:"td",type:"both"},null,8,["cell"]))],64)))),128))]))}}),[["__file","descriptions-row.vue"]]);const re=o({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},size:y,title:{type:String,default:""},extra:{type:String,default:""},labelWidth:{type:[String,Number],default:""}}),oe=e({name:"ElDescriptions"});var ue=h(e({...oe,props:re,setup(e){const l=e,a=s("descriptions"),t=_(),i=w();k(ae,l);const n=S((()=>[a.b(),a.m(t.value)])),r=(e,l,a,t=!1)=>(e.props||(e.props={}),l>a&&(e.props.span=a),t&&(e.props.span=l),e),o=()=>{if(!i.default)return[];const e=j(i.default()).filter((e=>{var l;return"ElDescriptionsItem"===(null==(l=null==e?void 0:e.type)?void 0:l.name)})),a=[];let t=[],s=l.column,n=0;const o=[];return e.forEach(((i,u)=>{var d,c,p;const v=(null==(d=i.props)?void 0:d.span)||1,m=(null==(c=i.props)?void 0:c.rowspan)||1,g=a.length;if(o[g]||(o[g]=0),m>1)for(let e=1;e<m;e++)o[p=g+e]||(o[p]=0),o[g+e]++,n++;if(o[g]>0&&(s-=o[g],o[g]=0),u<e.length-1&&(n+=v>s?s:v),u===e.length-1){const e=l.column-n%l.column;return t.push(r(i,e,s,!0)),void a.push(t)}v<s?(s-=v,t.push(i)):(t.push(r(i,v,s)),a.push(t),s=l.column,t=[])})),a};return(e,l)=>(c(),p("div",{class:C(d(n))},[e.title||e.extra||e.$slots.title||e.$slots.extra?(c(),p("div",{key:0,class:C(d(a).e("header"))},[v("div",{class:C(d(a).e("title"))},[x(e.$slots,"title",{},(()=>[N(V(e.title),1)]))],2),v("div",{class:C(d(a).e("extra"))},[x(e.$slots,"extra",{},(()=>[N(V(e.extra),1)]))],2)],2)):$("v-if",!0),v("div",{class:C(d(a).e("body"))},[v("table",{class:C([d(a).e("table"),d(a).is("bordered",e.border)])},[v("tbody",null,[(c(!0),p(m,null,g(o(),((e,l)=>(c(),b(ne,{key:l,row:e},null,8,["row"])))),128))])],2)],2)],2))}}),[["__file","description.vue"]]);const de=e({name:"ElDescriptionsItem",props:o({label:{type:String,default:""},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},labelWidth:{type:[String,Number],default:""},align:{type:String,default:"left"},labelAlign:{type:String,default:""},className:{type:String,default:""},labelClassName:{type:String,default:""}})}),ce=z(ue,{DescriptionsItem:de}),pe=E(de),ve=o({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:D}}),me={click:e=>e instanceof MouseEvent},ge=e({name:"ElLink"});const be=z(h(e({...ge,props:ve,emits:me,setup(e,{emit:l}){const a=e,t=s("link"),i=S((()=>[t.b(),t.m(a.type),t.is("disabled",a.disabled),t.is("underline",a.underline&&!a.disabled)]));function n(e){a.disabled||l("click",e)}return(e,l)=>(c(),p("a",{class:C(d(i)),href:e.disabled||!e.href?void 0:e.href,target:e.disabled||!e.href?void 0:e.target,onClick:n},[e.icon?(c(),b(d(U),{key:0},{default:I((()=>[(c(),b(W(e.icon)))])),_:1})):$("v-if",!0),e.$slots.default?(c(),p("span",{key:1,class:C(d(t).e("inner"))},[x(e.$slots,"default")],2)):$("v-if",!0),e.$slots.icon?x(e.$slots,"icon",{key:2}):$("v-if",!0)],10,["href","target"]))}}),[["__file","link.vue"]])),fe={class:"complaint-management"},he={class:"page-header"},ye={class:"header-left"},_e=(e=>(K("data-v-76745ba6"),e=e(),O(),e))((()=>v("h1",{class:"page-title"},"投诉管理",-1))),we={key:0,class:"success-message"},ke={class:"search-container"},Se={class:"search-form"},Ce={class:"table-container"},xe={class:"pagination-container"},Ne={key:0,class:"complaint-detail"},Ve={class:"content-text"},$e={class:"image-gallery"},je={class:"image-gallery-large"},ze=X(e({__name:"ComplaintManagement",setup(e){const l=B(!1),a=B(""),t=B([]),s=B(!1),n=B(!1),r=B(null),o=B([]),u=A({channelName:"",status:""}),d=A({page:1,limit:20,total:0});M((()=>{h()}));const h=async()=>{try{l.value=!0;const e={page:d.page,limit:d.limit,...u},a=await P.getComplaints(e);t.value=a.list,d.total=a.total}catch(e){q.error("加载投诉列表失败")}finally{l.value=!1}},y=()=>{d.page=1,h()},_=()=>{u.channelName="",u.status="",d.page=1,h()},w=e=>{d.limit=e,d.page=1,h()},k=e=>{d.page=e,h()},S=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},C=e=>({pending:"待处理",processing:"处理中",resolved:"已解决",rejected:"已拒绝"}[e]||e);return(e,x)=>{const j=L,z=R,E=T,D=F,W=Y,U=be,B=Z,A=J,M=pe,K=H,O=Q,X=ce,ae=le,te=ee;return c(),p("div",fe,[v("div",he,[v("div",ye,[_e,a.value?(c(),p("div",we,V(a.value),1)):$("",!0)])]),v("div",ke,[v("div",Se,[f(j,{modelValue:u.channelName,"onUpdate:modelValue":x[0]||(x[0]=e=>u.channelName=e),placeholder:"请输入通道名称",class:"search-input",clearable:""},null,8,["modelValue"]),f(E,{modelValue:u.status,"onUpdate:modelValue":x[1]||(x[1]=e=>u.status=e),placeholder:"请选择处理状态",class:"search-select",clearable:""},{default:I((()=>[f(z,{label:"全部",value:""}),f(z,{label:"待处理",value:"pending"}),f(z,{label:"处理中",value:"processing"}),f(z,{label:"已解决",value:"resolved"}),f(z,{label:"已拒绝",value:"rejected"})])),_:1},8,["modelValue"]),f(D,{type:"primary",onClick:y},{default:I((()=>[N("搜索")])),_:1}),f(D,{onClick:_},{default:I((()=>[N("重置")])),_:1})])]),v("div",Ce,[i((c(),b(B,{data:t.value,class:"complaints-table",stripe:""},{default:I((()=>[f(W,{prop:"id",label:"投诉ID",width:"100"}),f(W,{prop:"channel_id",label:"投诉通道",width:"150"},{default:I((({row:e})=>{var l;return[v("p",null,V(null==(l=null==e?void 0:e.channel)?void 0:l.channel_name),1)]})),_:1}),f(W,{prop:"contact",label:"投诉人手机号",width:"150"}),f(W,{prop:"complaint_type",label:"投诉类型",width:"200","show-overflow-tooltip":""}),f(W,{label:"投诉内容"},{default:I((({row:e})=>[v("p",null,[v("p",null,[N(V(e.complaint_content)+" ",1),e.image_urls&&e.image_urls.length>0?(c(),b(U,{key:0,type:"primary",onClick:l=>(e=>{var l;o.value=null==(l=e.image_urls)?void 0:l.map((e=>"https://qywx.menghuaa.cn/"+e.url)),n.value=!0})(e)},{default:I((()=>[N(" 有图片 ")])),_:2},1032,["onClick"])):$("",!0)])])])),_:1}),f(W,{label:"ip归属地",width:"150",prop:"ip_location"}),f(W,{label:"ip地址",width:"150",prop:"submitter_ip"}),f(W,{label:"处理状态",width:"150"},{default:I((({row:e})=>[f(E,{modelValue:e.processing_status,"onUpdate:modelValue":l=>e.processing_status=l,onChange:l=>(async e=>{try{await P.updateComplaintStatus(e.id,{status:e.processing_status}),q.success("状态更新成功"),h()}catch(l){q.error("更新状态失败"),h()}})(e),class:"status-select"},{default:I((()=>[f(z,{label:"待处理",value:"pending"}),f(z,{label:"处理中",value:"processing"}),f(z,{label:"已解决",value:"resolved"}),f(z,{label:"已拒绝",value:"rejected"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),f(W,{prop:"submitted_at",label:"投诉时间",width:"180"},{default:I((({row:e})=>[N(V(S(e.submitted_at)),1)])),_:1}),f(W,{label:"操作",width:"150",fixed:"right"},{default:I((({row:e})=>[f(D,{type:"danger",size:"small",onClick:l=>(async e=>{try{await G.confirm(`确定要删除投诉 ${e.id} 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P.deleteComplaint(e.id),q.success("删除成功"),h()}catch(l){"cancel"!==l&&q.error("删除投诉失败")}})(e)},{default:I((()=>[N(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[te,l.value]]),v("div",xe,[f(A,{"current-page":d.page,"onUpdate:currentPage":x[2]||(x[2]=e=>d.page=e),"page-size":d.limit,"onUpdate:pageSize":x[3]||(x[3]=e=>d.limit=e),"page-sizes":[10,20,50,100],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:k},null,8,["current-page","page-size","total"])])]),f(ae,{modelValue:s.value,"onUpdate:modelValue":x[5]||(x[5]=e=>s.value=e),title:"投诉详情",width:"800px","close-on-click-modal":!1},{footer:I((()=>[f(D,{onClick:x[4]||(x[4]=e=>s.value=!1)},{default:I((()=>[N("关闭")])),_:1})])),default:I((()=>[r.value?(c(),p("div",Ne,[f(X,{column:2,border:""},{default:I((()=>[f(M,{label:"投诉ID"},{default:I((()=>[N(V(r.value.id),1)])),_:1}),f(M,{label:"投诉通道"},{default:I((()=>[N(V(r.value.channel_id),1)])),_:1}),f(M,{label:"投诉人手机号"},{default:I((()=>[N(V(r.value.contact),1)])),_:1}),f(M,{label:"投诉类型"},{default:I((()=>[N(V(r.value.complaint_type),1)])),_:1}),f(M,{label:"处理状态"},{default:I((()=>{return[f(K,{type:(e=r.value.processing_status,{pending:"warning",processing:"info",resolved:"success",rejected:"danger"}[e]||"info")},{default:I((()=>[N(V(C(r.value.processing_status)),1)])),_:1},8,["type"])];var e})),_:1}),f(M,{label:"投诉时间"},{default:I((()=>[N(V(S(r.value.submitted_at)),1)])),_:1}),f(M,{label:"提交IP"},{default:I((()=>[N(V(r.value.submitter_ip),1)])),_:1}),f(M,{label:"IP位置"},{default:I((()=>[N(V(r.value.ip_location),1)])),_:1}),f(M,{label:"投诉内容",span:2},{default:I((()=>[v("div",Ve,V(r.value.complaint_content),1)])),_:1}),r.value.image_urls&&r.value.image_urls.length>0?(c(),b(M,{key:0,label:"图片证据",span:2},{default:I((()=>[v("div",$e,[(c(!0),p(m,null,g(r.value.image_urls,((e,l)=>(c(),b(O,{key:l,src:e,"preview-src-list":r.value.image_urls,class:"evidence-image",fit:"cover"},null,8,["src","preview-src-list"])))),128))])])),_:1})):$("",!0)])),_:1})])):$("",!0)])),_:1},8,["modelValue"]),f(ae,{modelValue:n.value,"onUpdate:modelValue":x[6]||(x[6]=e=>n.value=e),title:"图片证据",width:"80%","close-on-click-modal":!1},{default:I((()=>[v("div",je,[(c(!0),p(m,null,g(o.value,((e,l)=>(c(),b(O,{key:l,src:e,"preview-src-list":o.value,class:"evidence-image-large",fit:"contain"},null,8,["src","preview-src-list"])))),128))])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-76745ba6"]]);export{ze as default};
