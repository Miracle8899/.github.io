import{d as a,r as e,b as l,o as t,k as s,n as i,c as n,e as c,f as d,g as o,t as u,z as r,h as m,w as p,j as v,F as g,q as _,p as h,l as y,_ as w}from"./index-fb5e286d.js";const f=a=>(h("data-v-439bbb61"),a=a(),y(),a),b={class:"complaint-management"},k={class:"page-header"},x={class:"header-left"},C=f((()=>o("h1",{class:"page-title"},"投诉管理",-1))),V={key:0,class:"success-message"},S={class:"search-container"},j={class:"search-form"},U={class:"table-container"},$={class:"complaint-content"},N={key:0,class:"complaint-detail",style:{padding:"20px"}},z={class:"detail-row"},I={class:"detail-item"},M=f((()=>o("span",{class:"detail-label"},"投诉编号:",-1))),W={class:"detail-value"},q={class:"detail-item"},D=f((()=>o("span",{class:"detail-label"},"投诉时间:",-1))),P={class:"detail-value"},F={class:"detail-row"},L={class:"detail-item"},A=f((()=>o("span",{class:"detail-label"},"员工姓名:",-1))),B={class:"detail-value"},E={class:"detail-item"},G=f((()=>o("span",{class:"detail-label"},"所属部门:",-1))),H={class:"detail-value"},J={class:"detail-row"},K={class:"detail-item"},O=f((()=>o("span",{class:"detail-label"},"投诉人手机:",-1))),Q={class:"detail-value"},R={class:"detail-item"},T=f((()=>o("span",{class:"detail-label"},"通道累计投诉次数:",-1))),X={class:"detail-value"},Y={class:"detail-row"},Z={class:"detail-item"},aa=f((()=>o("span",{class:"detail-label"},"投诉人IP:",-1))),ea={class:"detail-value"},la={class:"detail-item"},ta=f((()=>o("span",{class:"detail-label"},"IP归属地:",-1))),sa={class:"detail-value"},ia={class:"detail-row"},na={class:"detail-item"},ca=f((()=>o("span",{class:"detail-label"},"办理状态:",-1))),da={class:"detail-value"},oa={class:"detail-row full-width"},ua={class:"detail-item"},ra=f((()=>o("span",{class:"detail-label"},"投诉类型:",-1))),ma={class:"detail-value"},pa={class:"detail-row full-width"},va={class:"detail-item"},ga=f((()=>o("span",{class:"detail-label"},"投诉内容:",-1))),_a={class:"detail-value content-text"},ha={key:0,class:"detail-row full-width"},ya={class:"detail-item"},wa=f((()=>o("span",{class:"detail-label"},"相关截图:",-1))),fa={class:"detail-value"},ba={class:"image-gallery"},ka=["src","onClick"],xa={class:"image-gallery-large",style:{padding:"20px"}},Ca=["src","onClick"],Va={style:{padding:"20px"}},Sa=w(a({__name:"ComplaintManagement-layui",setup(a){const h="https://qywx.menghuaa.cn/",y=e(!1),w=e(""),f=e([]),Sa=e(!1),ja=e(!1),Ua=e(null),$a=e([]),Na=e(0),za=l({channelName:"",status:""}),Ia=l({current:1,limit:20,total:0}),Ma=[{title:"投诉ID",key:"id",customSlot:"id",width:"100px"},{title:"投诉通道",key:"channel_name",customSlot:"channel_name",width:"120px"},{title:"投诉人手机号",key:"contact",customSlot:"contact",width:"150px"},{title:"投诉类型",key:"complaint_type",customSlot:"complaint_type",width:"150px"},{title:"投诉内容",key:"complaint_content",customSlot:"complaint_content",minWidth:"200px"},{title:"处理状态",key:"processing_status",customSlot:"processing_status",width:"150px"},{title:"投诉时间",key:"submitted_at",customSlot:"submitted_at",width:"150px"},{title:"操作",customSlot:"operator",width:"180px",fixed:"right"}];t((()=>{document.title="投诉管理",Wa()}));const Wa=async()=>{try{y.value=!0;const a={page:Ia.current,limit:Ia.limit,...za},e=await s.getComplaints(a);f.value=e.list,Ia.total=e.total}catch(a){i.msg("加载投诉列表失败: "+a.message,{icon:2})}finally{y.value=!1}},qa=({current:a,limit:e})=>{Ia.current=a,Ia.limit=e,Wa()},Da=()=>{Ia.current=1,Wa()},Pa=()=>{za.channelName="",za.status="",Ia.current=1,Wa()},Fa=a=>{try{return a?"string"==typeof a?a.startsWith("http")?a:`${h}${a}`:a&&"object"==typeof a&&a.url?a.url.startsWith("http")?a.url:`${h}${a.url}`:"":""}catch(e){return""}},La=(a,e)=>{if(a&&0!==a.length)try{const l=a.map((a=>Fa(a))).filter((a=>a));if(0===l.length)return void i.msg("图片加载失败",{icon:2});const t=Math.max(0,Math.min(e,l.length-1));"undefined"!=typeof window&&window.layui?window.layui.photos({photos:{data:l.map(((a,e)=>({src:a,alt:`图片${e+1}`})))},start:t}):window.open(l[t],"_blank")}catch(l){i.msg("预览图片失败",{icon:2})}else i.msg("没有可预览的图片",{icon:2})},Aa=a=>{if(!a)return"";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},Ba=a=>({pending:"待处理",processing:"处理中",resolved:"已解决",rejected:"已拒绝"}[a]||a);return(a,e)=>{const l=n("lay-input"),t=n("lay-select-option"),h=n("lay-select"),Ea=n("lay-button"),Ga=n("lay-table"),Ha=n("lay-tag"),Ja=n("lay-layer");return c(),d("div",b,[o("div",k,[o("div",x,[C,w.value?(c(),d("div",V,u(w.value),1)):r("",!0)])]),o("div",S,[o("div",j,[m(l,{modelValue:za.channelName,"onUpdate:modelValue":e[0]||(e[0]=a=>za.channelName=a),placeholder:"请输入通道名称","allow-clear":""},null,8,["modelValue"]),m(h,{modelValue:za.status,"onUpdate:modelValue":e[1]||(e[1]=a=>za.status=a),placeholder:"请选择处理状态"},{default:p((()=>[m(t,{value:""},{default:p((()=>[v("全部")])),_:1}),m(t,{value:"pending"},{default:p((()=>[v("待处理")])),_:1}),m(t,{value:"processing"},{default:p((()=>[v("处理中")])),_:1}),m(t,{value:"resolved"},{default:p((()=>[v("已解决")])),_:1}),m(t,{value:"rejected"},{default:p((()=>[v("已拒绝")])),_:1})])),_:1},8,["modelValue"]),m(Ea,{type:"primary",onClick:Da},{default:p((()=>[v("搜索")])),_:1}),m(Ea,{onClick:Pa},{default:p((()=>[v("重置")])),_:1})])]),o("div",U,[m(Ga,{columns:Ma,"data-source":f.value,loading:y.value,page:Ia,onChange:qa},{id:p((({row:a})=>[v(u(a.id),1)])),channel_name:p((({row:a})=>{var e;return[v(u(null==(e=null==a?void 0:a.channel)?void 0:e.channel_name),1)]})),contact:p((({row:a})=>[v(u(a.contact),1)])),complaint_type:p((({row:a})=>[v(u(a.complaint_type),1)])),complaint_content:p((({row:a})=>[o("div",$,[o("span",null,u(a.complaint_content),1)])])),processing_status:p((({row:a})=>[m(h,{modelValue:a.processing_status,"onUpdate:modelValue":e=>a.processing_status=e,onChange:e=>(async a=>{try{await s.updateComplaintStatus(a.id,{status:a.processing_status}),i.msg("状态更新成功",{icon:1}),Wa()}catch(e){i.msg("更新状态失败: "+e.message,{icon:2}),Wa()}})(a)},{default:p((()=>[m(t,{value:"pending"},{default:p((()=>[v("待处理")])),_:1}),m(t,{value:"processing"},{default:p((()=>[v("处理中")])),_:1}),m(t,{value:"resolved"},{default:p((()=>[v("已解决")])),_:1}),m(t,{value:"rejected"},{default:p((()=>[v("已拒绝")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),submitted_at:p((({row:a})=>[v(u(Aa(a.submitted_at)),1)])),operator:p((({row:a})=>[m(Ea,{size:"xs",type:"primary",onClick:e=>(async a=>{try{const e=await s.getComplaint(a.id);Ua.value=e,Na.value=e.complaint_count||0,Sa.value=!0}catch(e){i.msg("获取投诉详情失败: "+e.message,{icon:2})}})(a)},{default:p((()=>[v(" 查看详情 ")])),_:2},1032,["onClick"]),m(Ea,{size:"xs",type:"danger",onClick:e=>(async a=>{i.confirm(`确定要删除投诉 ${a.id} 吗？`,{title:"确认删除",btn:["确定","取消"]},(async e=>{try{await s.deleteComplaint(a.id),i.msg("删除成功",{icon:1}),i.close(e),Wa()}catch(l){i.msg("删除失败: "+l.message,{icon:2})}}))})(a)},{default:p((()=>[v(" 删除 ")])),_:2},1032,["onClick"])])),_:1},8,["data-source","loading","page"])]),m(Ja,{modelValue:Sa.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Sa.value=a),title:"投诉详情",area:["800px","auto"],maxmin:!0},{default:p((()=>{var a,e,l;return[Ua.value?(c(),d("div",N,[o("div",z,[o("div",I,[M,o("span",W,u(Ua.value.complaint_id_str||Ua.value.id),1)]),o("div",q,[D,o("span",P,u(Aa(Ua.value.submitted_at)),1)])]),o("div",F,[o("div",L,[A,o("span",B,u((null==(a=Ua.value.channel)?void 0:a.channel_name)||"未知"),1)]),o("div",E,[G,o("span",H,u((null==(e=Ua.value.channel)?void 0:e.description)||"未知"),1)])]),o("div",J,[o("div",K,[O,o("span",Q,u(Ua.value.contact),1)]),o("div",R,[T,o("span",X,u(Na.value||"0次"),1)])]),o("div",Y,[o("div",Z,[aa,o("span",ea,u(Ua.value.submitter_ip||"未知"),1)]),o("div",la,[ta,o("span",sa,u(Ua.value.ip_location||"未知"),1)])]),o("div",ia,[o("div",na,[ca,o("span",da,[m(Ha,{type:(l=Ua.value.processing_status,{pending:"warm",processing:"normal",resolved:"normal",rejected:"danger"}[l]||"normal")},{default:p((()=>[v(u(Ba(Ua.value.processing_status)),1)])),_:1},8,["type"])])])]),o("div",oa,[o("div",ua,[ra,o("span",ma,u(Ua.value.complaint_type),1)])]),o("div",pa,[o("div",va,[ga,o("div",_a,u(Ua.value.complaint_content),1)])]),Ua.value.image_urls&&Ua.value.image_urls.length>0?(c(),d("div",ha,[o("div",ya,[wa,o("div",fa,[o("div",ba,[(c(!0),d(g,null,_(Ua.value.image_urls,((a,e)=>(c(),d("img",{key:e,src:Fa(a),class:"evidence-image",onClick:a=>La(Ua.value.image_urls,e)},null,8,ka)))),128))])])])])):r("",!0)])):r("",!0)]})),_:1},8,["modelValue"]),m(Ja,{modelValue:ja.value,"onUpdate:modelValue":e[4]||(e[4]=a=>ja.value=a),title:"图片证据",area:["80%","80%"]},{footer:p((()=>[o("div",Va,[m(Ea,{onClick:e[3]||(e[3]=a=>ja.value=!1)},{default:p((()=>[v("关闭")])),_:1})])])),default:p((()=>[o("div",xa,[(c(!0),d(g,null,_($a.value,((a,e)=>(c(),d("img",{key:e,src:a,class:"evidence-image-large",onClick:a=>La($a.value,e)},null,8,Ca)))),128))])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-439bbb61"]]);export{Sa as default};
