import{d as e,r as a,b as l,o as n,l as t,E as s,c,e as i,f as u,t as o,I as r,g as d,w as p,h as m,j as h,ax as v,$ as _,F as f,C as g,aB as y,G as b,q as w,aK as C,m as k,n as V,s as x,aI as z,aG as U,v as $,x as j,aO as S,aU as T,aL as X,aV as B,aW as F,aX as q,_ as E}from"./index-9d598a61.js";import{E as I,a as G,b as L,v as R}from"./table-column-57f0bf42.js";import{E as A}from"./overlay-42c35654.js";const D=e=>($("data-v-c7457c55"),e=e(),j(),e),H={class:"channels-page"},K={class:"page-header"},M={class:"header-left"},O=D((()=>u("h1",{class:"page-title"},"通道管理",-1))),P={key:0,class:"success-message"},W={class:"header-actions"},J={class:"table-container"},N={class:"channel-link"},Q={class:"link-text"},Y=D((()=>u("span",{class:"link-warning"},"(禁止发到微信对话框直接点击访问)",-1))),Z={class:"pagination-container"},ee={class:"batch-create-content"},ae={class:"batch-create-hint"},le=D((()=>u("span",null,"每行一个通道名称,系统将自动为每个通道生成唯一的短链和落地页",-1))),ne={class:"batch-create-instructions"},te={class:"instructions-header"},se=D((()=>u("span",null,"批量创建说明",-1))),ce=D((()=>u("ul",{class:"instructions-list"},[u("li",null,"每行输入一个通道名称"),u("li",null,"空行将被自动忽略"),u("li",null,"系统将自动生成短链和落地页"),u("li",null,"建议一次创建不超过10个通道")],-1))),ie={class:"batch-copy-content"},ue={class:"copy-actions"},oe=D((()=>u("div",{class:"channel-info-header"},[u("span",null,"通道信息列表")],-1))),re={class:"channel-info-list"},de={class:"channel-name"},pe={class:"channel-url"},me={class:"copy-instructions"},he=D((()=>u("span",null,"点击上方按钮可以复制不同格式的所有通道信息 (自动获取全部数据,不受分页限制)",-1))),ve=E(e({__name:"index",setup(e){const $=a(!1),j=a([]),E=a(""),D=a([]),ve=a([]),_e=l({page:1,pageSize:20,total:0}),fe=a(!1),ge=a(!1),ye=l({channel_name:"",description:""}),be={channel_name:[{required:!0,message:"请输入通道名称",trigger:"blur"}]},we=a(),Ce=a(!1),ke=a(!1),Ve=l({id:null,channel_name:"",description:"",status:"enabled"}),xe={channel_name:[{required:!0,message:"请输入通道名称",trigger:"blur"}]},ze=a(),Ue=a(!1),$e=a(!1),je=l({channel_names:""}),Se=a(!1);n((()=>{document.title="通道管理",Te()}));const Te=async()=>{try{$.value=!0;const e=await t.getChannels({page:_e.page,pageSize:_e.pageSize});j.value=e.list,_e.total=e.total}catch(e){s.error("加载通道列表失败: "+e.message)}finally{$.value=!1}},Xe=()=>{ye.channel_name="",ye.description="",fe.value=!0},Be=async()=>{var e;try{await(null==(e=we.value)?void 0:e.validate()),ge.value=!0;await t.createChannel({channel_name:ye.channel_name,description:ye.description});s.success("创建成功"),fe.value=!1,Te()}catch(a){s.error("创建失败: "+a.message)}finally{ge.value=!1}},Fe=()=>{var e;fe.value=!1,null==(e=we.value)||e.resetFields()},qe=async()=>{var e;try{await(null==(e=ze.value)?void 0:e.validate()),ke.value=!0;200===(await t.updateChannel(Ve.id,{channel_name:Ve.channel_name,description:Ve.description,status:Ve.status})).code&&(s.success("更新成功"),Ce.value=!1,Te())}catch(a){s.error("更新失败: "+a.message)}finally{ke.value=!1}},Ee=()=>{var e;Ce.value=!1,null==(e=ze.value)||e.resetFields()},Ie=e=>{ve.value=e},Ge=async()=>{if(0!==ve.value.length)try{const e=ve.value.map((e=>e.channel_name)).join("、");await y.confirm(`确定要删除选中的 ${ve.value.length} 个通道吗？\n\n删除的通道：${e}`,"确认批量删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0});const a=ve.value.map((e=>e.id));await t.batchDeleteChannels(a);s.success(`成功删除 ${ve.value.length} 个通道`),ve.value=[],Te()}catch(e){"cancel"!==e&&s.error("批量删除失败: "+e.message)}else s.warning("请先选择要删除的通道")},Le=()=>{je.channel_names="",Ue.value=!0},Re=async()=>{try{if(!je.channel_names.trim())return void s.warning("请输入通道名称");$e.value=!0;const e=je.channel_names.split("\n").map((e=>e.trim())).filter((e=>e));if(0===e.length)return void s.warning("请输入有效的通道名称");const a=(await t.batchCreateChannels({channel_names:e})).created.length;E.value=`成功创建${a}个通道`,s.success(`成功创建${a}个通道`),Ue.value=!1,Te(),setTimeout((()=>{E.value=""}),3e3)}catch(e){s.error("批量创建失败: "+e.message)}finally{$e.value=!1}},Ae=()=>{Ue.value=!1,je.channel_names=""},De=async()=>{try{const e=await t.exportAllChannels();D.value=e,Se.value=!0}catch(e){s.error("获取通道信息失败: "+e.message)}},He=async()=>{try{const e=D.value.map(((e,a)=>`${a+1}. ${e.channel_name}\n${e.channel_url}`)).join("\n\n");await navigator.clipboard.writeText(e),s.success("已复制全部通道信息")}catch(e){s.error("复制失败")}},Ke=async()=>{try{const e=D.value.map(((e,a)=>`${a+1}. ${e.channel_name}`)).join("\n");await navigator.clipboard.writeText(e),s.success("已复制通道名称")}catch(e){s.error("复制失败")}},Me=async()=>{try{const e=D.value.map(((e,a)=>`${a+1}. ${e.channel_url}`)).join("\n");await navigator.clipboard.writeText(e),s.success("已复制通道链接")}catch(e){s.error("复制失败")}},Oe=()=>{Se.value=!1,D.value=[]},Pe=e=>{_e.pageSize=e,_e.page=1,Te()},We=e=>{_e.page=e,Te()};return(e,a)=>{const l=b,n=w,Je=I,Ne=C,Qe=G,Ye=L,Ze=k,ea=V,aa=x,la=A,na=z,ta=U,sa=R;return c(),i("div",H,[u("div",K,[u("div",M,[O,E.value?(c(),i("div",P,o(E.value),1)):r("",!0)]),u("div",W,[d(n,{type:"danger",onClick:Ge,disabled:0===ve.value.length,class:"batch-delete-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(S))])),_:1}),h(" 批量删除 ("+o(ve.value.length)+") ",1)])),_:1},8,["disabled"]),d(n,{type:"primary",onClick:Le,class:"batch-create-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(T))])),_:1}),h(" 批量创建 ")])),_:1}),d(n,{type:"success",onClick:De,class:"batch-copy-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(T))])),_:1}),h(" 批量复制 ")])),_:1}),d(n,{type:"info",onClick:Xe,class:"create-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(X))])),_:1}),h(" 新建通道 ")])),_:1})])]),u("div",J,[v((c(),_(Qe,{data:j.value,stripe:"",class:"channels-table",onSelectionChange:Ie},{default:p((()=>[d(Je,{type:"selection",width:"55"}),d(Je,{prop:"channel_name",label:"通道名称",width:"120"}),d(Je,{prop:"visit_count",label:"通道访问量",width:"120",align:"center"}),d(Je,{prop:"complaint_count",label:"通道投诉量",width:"120",align:"center"}),d(Je,{label:"通道链接","min-width":"300"},{default:p((({row:e})=>[u("div",N,[u("span",Q,o(e.channel_url),1),Y,d(n,{type:"primary",size:"small",onClick:a=>(async e=>{try{await navigator.clipboard.writeText(e),s.success("已复制到剪贴板")}catch(a){s.error("复制失败")}})(e.channel_url),class:"copy-btn"},{default:p((()=>[h(" 复制 ")])),_:2},1032,["onClick"])])])),_:1}),d(Je,{prop:"status",label:"状态",width:"100",align:"center"},{default:p((({row:e})=>[d(Ne,{type:"enabled"===e.status?"success":"danger"},{default:p((()=>[h(o("enabled"===e.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),d(Je,{label:"操作",width:"300",align:"center"},{default:p((({row:e})=>[d(n,{type:"primary",size:"small",onClick:a=>(e=>{Ve.id=e.id,Ve.channel_name=e.channel_name,Ve.description=e.description||"",Ve.status=e.status,Ce.value=!0})(e)},{default:p((()=>[h(" 编辑 ")])),_:2},1032,["onClick"]),d(n,{type:"enabled"===e.status?"danger":"success",size:"small",onClick:a=>(async e=>{try{const a="enabled"===e.status?"disabled":"enabled";await t.updateChannel(e.id,{status:a}),s.success("enabled"===a?"已启用":"已禁用"),Te()}catch(a){s.error("操作失败: "+a.message)}})(e)},{default:p((()=>[h(o("enabled"===e.status?"禁用":"启用"),1)])),_:2},1032,["type","onClick"]),d(n,{type:"danger",size:"small",onClick:a=>(async e=>{try{await y.confirm(`确定要删除通道"${e.channel_name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await t.deleteChannel(e.id),s.success("删除成功"),Te()}catch(a){"cancel"!==a&&s.error("删除失败: "+a.message)}})(e)},{default:p((()=>[h(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[sa,$.value]])]),u("div",Z,[d(Ye,{"current-page":_e.page,"onUpdate:currentPage":a[0]||(a[0]=e=>_e.page=e),"page-size":_e.pageSize,"onUpdate:pageSize":a[1]||(a[1]=e=>_e.pageSize=e),"page-sizes":[10,20,50,100],total:_e.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Pe,onCurrentChange:We},null,8,["current-page","page-size","total"])]),d(la,{modelValue:fe.value,"onUpdate:modelValue":a[5]||(a[5]=e=>fe.value=e),title:"新建通道",width:"500px","before-close":Fe},{footer:p((()=>[d(n,{onClick:a[4]||(a[4]=e=>fe.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:Be,loading:ge.value},{default:p((()=>[h(" 创建 ")])),_:1},8,["loading"])])),default:p((()=>[d(aa,{model:ye,rules:be,ref_key:"createFormRef",ref:we,"label-width":"100px"},{default:p((()=>[d(ea,{label:"通道名称",prop:"channel_name"},{default:p((()=>[d(Ze,{modelValue:ye.channel_name,"onUpdate:modelValue":a[2]||(a[2]=e=>ye.channel_name=e),placeholder:"请输入通道名称"},null,8,["modelValue"])])),_:1}),d(ea,{label:"通道描述",prop:"description"},{default:p((()=>[d(Ze,{modelValue:ye.description,"onUpdate:modelValue":a[3]||(a[3]=e=>ye.description=e),type:"textarea",rows:3,placeholder:"请输入通道描述（可选）"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),d(la,{modelValue:Ce.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Ce.value=e),title:"编辑通道",width:"500px","before-close":Ee},{footer:p((()=>[d(n,{onClick:a[9]||(a[9]=e=>Ce.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:qe,loading:ke.value},{default:p((()=>[h(" 保存 ")])),_:1},8,["loading"])])),default:p((()=>[d(aa,{model:Ve,rules:xe,ref_key:"editFormRef",ref:ze,"label-width":"100px"},{default:p((()=>[d(ea,{label:"通道名称",prop:"channel_name"},{default:p((()=>[d(Ze,{modelValue:Ve.channel_name,"onUpdate:modelValue":a[6]||(a[6]=e=>Ve.channel_name=e),placeholder:"请输入通道名称"},null,8,["modelValue"])])),_:1}),d(ea,{label:"通道描述",prop:"description"},{default:p((()=>[d(Ze,{modelValue:Ve.description,"onUpdate:modelValue":a[7]||(a[7]=e=>Ve.description=e),type:"textarea",rows:3,placeholder:"请输入通道描述（可选）"},null,8,["modelValue"])])),_:1}),d(ea,{label:"状态",prop:"status"},{default:p((()=>[d(ta,{modelValue:Ve.status,"onUpdate:modelValue":a[8]||(a[8]=e=>Ve.status=e),placeholder:"请选择状态"},{default:p((()=>[d(na,{label:"启用",value:"enabled"}),d(na,{label:"禁用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),d(la,{modelValue:Ue.value,"onUpdate:modelValue":a[13]||(a[13]=e=>Ue.value=e),title:"批量创建通道",width:"600px","before-close":Ae},{footer:p((()=>[d(n,{onClick:a[12]||(a[12]=e=>Ue.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:Re,loading:$e.value},{default:p((()=>[d(l,null,{default:p((()=>[d(m(T))])),_:1}),h(" 批量创建 ")])),_:1},8,["loading"])])),default:p((()=>[u("div",ee,[d(ea,{label:"通道名称列表",required:""},{default:p((()=>[d(Ze,{modelValue:je.channel_names,"onUpdate:modelValue":a[11]||(a[11]=e=>je.channel_names=e),type:"textarea",rows:8,placeholder:"请输入通道名称,一行一个:\nXX员工姓名1\nXX员工姓名2\nXX员工姓名3"},null,8,["modelValue"])])),_:1}),u("div",ae,[d(l,null,{default:p((()=>[d(m(B))])),_:1}),le]),u("div",ne,[u("div",te,[d(l,null,{default:p((()=>[d(m(B))])),_:1}),se]),ce])])])),_:1},8,["modelValue"]),d(la,{modelValue:Se.value,"onUpdate:modelValue":a[15]||(a[15]=e=>Se.value=e),title:"批量复制通道信息",width:"600px","before-close":Oe},{footer:p((()=>[d(n,{onClick:a[14]||(a[14]=e=>Se.value=!1)},{default:p((()=>[h("关闭")])),_:1})])),default:p((()=>[u("div",ie,[u("div",ue,[d(n,{type:"primary",onClick:He,class:"copy-all-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(B))])),_:1}),h(" 复制全部通道信息 ")])),_:1}),d(n,{type:"success",onClick:Ke,class:"copy-names-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(F))])),_:1}),h(" 只复制名称 ")])),_:1}),d(n,{type:"warning",onClick:Me,class:"copy-links-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(q))])),_:1}),h(" 只复制链接 ")])),_:1})]),oe,u("div",re,[(c(!0),i(f,null,g(D.value,((e,a)=>(c(),i("div",{key:e.id,class:"channel-info-item"},[u("div",de,o(a+1)+". "+o(e.channel_name),1),u("div",pe,o(e.channel_url),1)])))),128))]),u("div",me,[d(l,null,{default:p((()=>[d(m(B))])),_:1}),he])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c7457c55"]]);export{ve as default};
