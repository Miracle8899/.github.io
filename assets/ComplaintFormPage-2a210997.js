import{d as a,u as e,m as t,r as n,o as s,b as o,e as l,f as c,g as r,h as i,y as u,t as m,z as d,w as p,s as v,j as f,E as g,k as y,A as h,x as b,B as w,C as x,p as _,l as I,D as z,_ as V}from"./index-fb5e286d.js";const j=a=>(_("data-v-bc782727"),a=a(),I(),a),k={class:"complaint-form-page"},C={class:"form-container"},F={class:"form-section"},N=j((()=>r("div",{class:"form-label"}," 联系方式(必填) ",-1))),P={key:0,class:"error-message"},T={class:"form-section"},U=j((()=>r("div",{class:"form-label"}," 图片证据(选填) ",-1))),q={class:"upload-trigger"},G={class:"form-section c1"},R={key:0,class:"error-message"},B={class:"mt-[20px] px-[20px]"},E=V(a({__name:"ComplaintFormPage",setup(a){const _=e(),I=t(),V=n(),j=n([]);s((()=>{document.title="企业微信投诉"}));const E=o({contact:"",content:"",images:[]}),L=o({contact:"",content:""}),S=n(!1),A=n(""),D=n("");s((async()=>{A.value=I.query.violationType||"",D.value=I.query.fraudType||""}));const J=async(a,e)=>{try{const e=await W(a.raw);j.value.push(e),g.success("图片上传成功")}catch(t){g.error("图片上传失败: "+t.message);const n=e.findIndex((e=>e.uid===a.uid));n>-1&&e.splice(n,1)}},M=async(a,e)=>{var t,n;try{(null==(n=null==(t=a.response)?void 0:t.data)?void 0:n.filename)&&await $(a.response.data.filename),j.value=e,E.images=e.map((a=>{var e,t;return{file:a.raw,url:a.url||URL.createObjectURL(a.raw),filename:(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.filename)||"",originalName:a.name,size:a.size}}))}catch(s){g.error("删除文件失败")}},O=a=>{if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type))return g.error("只能上传图片文件 (JPEG, PNG, GIF, WebP)!"),!1;return a.size>5242880?(g.error("图片大小不能超过5MB!"),!1):!(E.images.length>=9)||(g.error("最多只能上传9张图片!"),!1)},W=async a=>await y.uploadSingleFile(a),$=async a=>await y.deleteFile(a),H=a=>/^1[3-9]\d{9}$/.test(a),K=()=>{const a=E.contact.trim();L.contact="",a&&(H(a)||(L.contact="请输入正确的手机号码"))},Q=async()=>{var a,e;if(!(()=>{let a=!0;return L.contact="",L.content="",E.contact.trim()?H(E.contact.trim())||(L.contact="请输入正确的手机号码",a=!1):(L.contact="请输入联系方式",a=!1),E.content.trim()?E.content.trim().length<5&&(L.content="投诉内容至少需要5个字符",a=!1):(L.content="请输入投诉内容",a=!1),a})())return;S.value=!0;const t=sessionStorage.getItem("channelId");try{const n={contact:E.contact,content:E.content,reason:I.query.reason||"",violationType:A.value,fraudType:D.value,channelId:t,images:null==(e=null==(a=j.value)?void 0:a.map)?void 0:e.call(a,(a=>({filename:a.filename,originalName:a.originalName,size:a.size,url:a.url})))};await y.submitComplaint(n);_.push("/complaint/success")}catch(n){}finally{S.value=!1}};return(a,e)=>{const t=h,n=b,s=w,o=x;return l(),c("div",k,[r("div",C,[r("div",F,[N,i(t,{modelValue:E.contact,"onUpdate:modelValue":e[0]||(e[0]=a=>E.contact=a),placeholder:"请输入手机号码",class:u(["form-input",{error:L.contact}]),onInput:K},null,8,["modelValue","class"]),L.contact?(l(),c("div",P,m(L.contact),1)):d("",!0)]),r("div",T,[U,i(s,{ref_key:"uploadRef",ref:V,"file-list":j.value,"auto-upload":!1,"on-change":J,"on-remove":M,"before-upload":O,multiple:"","list-type":"picture-card",accept:"image/*",class:"custom-upload"},{default:p((()=>[r("div",q,[i(n,{class:"camera-icon"},{default:p((()=>[i(v(z))])),_:1})])])),_:1},8,["file-list"])]),r("div",G,[i(t,{modelValue:E.content,"onUpdate:modelValue":e[1]||(e[1]=a=>E.content=a),type:"textarea",rows:6,placeholder:"投诉内容(必填)",class:u(["form-textarea",{error:L.content}])},null,8,["modelValue","class"]),L.content?(l(),c("div",R,m(L.content),1)):d("",!0)])]),r("div",B,[i(o,{type:"primary",class:"submit-button",loading:S.value,onClick:Q},{default:p((()=>[f(" 提交 ")])),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-bc782727"]]);export{E as default};
