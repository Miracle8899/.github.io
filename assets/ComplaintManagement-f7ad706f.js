import{d as e,R as l,aY as a,aa as t,a8 as s,ax as n,aZ as i,a_ as r,M as o,N as u,h as c,c as d,e as p,f as v,F as m,C as g,$ as f,g as h,Q as b,a$ as y,ae as _,b0 as w,S as k,A as S,H as C,X as $,j as x,t as N,I as V,b1 as z,av as j,aw as E,aS as W,w as D,am as I,G as U,r as B,b as A,o as M,l as P,E as q,aB as G,m as L,aI as R,aG as T,q as F,aK as H,v as K,x as O,b2 as Q,_ as X}from"./index-9d598a61.js";import{E as Y,a as Z,b as J,v as ee}from"./table-column-57f0bf42.js";import{E as le}from"./overlay-42c35654.js";const ae=Symbol("elDescriptions");var te=e({name:"ElDescriptionsCell",props:{cell:{type:Object},tag:{type:String,default:"td"},type:{type:String}},setup:()=>({descriptions:l(ae,{})}),render(){var e;const l=a(this.cell),o=((null==(e=this.cell)?void 0:e.dirs)||[]).map((e=>{const{dir:l,arg:a,modifiers:t,value:s}=e;return[l,s,a,t]})),{border:u,direction:c}=this.descriptions,d="vertical"===c,p=()=>{var e,a,t;return(null==(t=null==(a=null==(e=this.cell)?void 0:e.children)?void 0:a.label)?void 0:t.call(a))||l.label},v=()=>{var e,l,a;return null==(a=null==(l=null==(e=this.cell)?void 0:e.children)?void 0:l.default)?void 0:a.call(l)},m=l.span,g=l.rowspan,f=l.align?`is-${l.align}`:"",h=l.labelAlign?`is-${l.labelAlign}`:f,b=l.className,y=l.labelClassName,_="label"===this.type&&(l.labelWidth||this.descriptions.labelWidth)||l.width,w={width:t(_),minWidth:t(l.minWidth)},k=s("descriptions");switch(this.type){case"label":return n(i(this.tag,{style:w,class:[k.e("cell"),k.e("label"),k.is("bordered-label",u),k.is("vertical-label",d),h,y],colSpan:d?m:1,rowspan:d?1:g},p()),o);case"content":return n(i(this.tag,{style:w,class:[k.e("cell"),k.e("content"),k.is("bordered-content",u),k.is("vertical-content",d),f,b],colSpan:d?m:2*m-1,rowspan:d?2*g-1:g},v()),o);default:{const e=p(),a={},s=t(l.labelWidth||this.descriptions.labelWidth);return s&&(a.width=s,a.display="inline-block"),n(i("td",{style:w,class:[k.e("cell"),f],colSpan:m,rowspan:g},[r(e)?void 0:i("span",{style:a,class:[k.e("label"),y]},e),i("span",{class:[k.e("content"),b]},v())]),o)}}}});const se=o({row:{type:u(Array),default:()=>[]}}),ne=e({name:"ElDescriptionsRow"});var ie=b(e({...ne,props:se,setup(e){const a=l(ae,{});return(e,l)=>"vertical"===c(a).direction?(d(),p(m,{key:0},[v("tr",null,[(d(!0),p(m,null,g(e.row,((e,l)=>(d(),f(c(te),{key:`tr1-${l}`,cell:e,tag:"th",type:"label"},null,8,["cell"])))),128))]),v("tr",null,[(d(!0),p(m,null,g(e.row,((e,l)=>(d(),f(c(te),{key:`tr2-${l}`,cell:e,tag:"td",type:"content"},null,8,["cell"])))),128))])],64)):(d(),p("tr",{key:1},[(d(!0),p(m,null,g(e.row,((e,l)=>(d(),p(m,{key:`tr3-${l}`},[c(a).border?(d(),p(m,{key:0},[h(c(te),{cell:e,tag:"td",type:"label"},null,8,["cell"]),h(c(te),{cell:e,tag:"td",type:"content"},null,8,["cell"])],64)):(d(),f(c(te),{key:1,cell:e,tag:"td",type:"both"},null,8,["cell"]))],64)))),128))]))}}),[["__file","descriptions-row.vue"]]);const re=o({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},size:y,title:{type:String,default:""},extra:{type:String,default:""},labelWidth:{type:[String,Number],default:""}}),oe=e({name:"ElDescriptions"});var ue=b(e({...oe,props:re,setup(e){const l=e,a=s("descriptions"),t=_(),n=w();k(ae,l);const i=S((()=>[a.b(),a.m(t.value)])),r=(e,l,a,t=!1)=>(e.props||(e.props={}),l>a&&(e.props.span=a),t&&(e.props.span=l),e),o=()=>{if(!n.default)return[];const e=z(n.default()).filter((e=>{var l;return"ElDescriptionsItem"===(null==(l=null==e?void 0:e.type)?void 0:l.name)})),a=[];let t=[],s=l.column,i=0;const o=[];return e.forEach(((n,u)=>{var c,d,p;const v=(null==(c=n.props)?void 0:c.span)||1,m=(null==(d=n.props)?void 0:d.rowspan)||1,g=a.length;if(o[g]||(o[g]=0),m>1)for(let e=1;e<m;e++)o[p=g+e]||(o[p]=0),o[g+e]++,i++;if(o[g]>0&&(s-=o[g],o[g]=0),u<e.length-1&&(i+=v>s?s:v),u===e.length-1){const e=l.column-i%l.column;return t.push(r(n,e,s,!0)),void a.push(t)}v<s?(s-=v,t.push(n)):(t.push(r(n,v,s)),a.push(t),s=l.column,t=[])})),a};return(e,l)=>(d(),p("div",{class:C(c(i))},[e.title||e.extra||e.$slots.title||e.$slots.extra?(d(),p("div",{key:0,class:C(c(a).e("header"))},[v("div",{class:C(c(a).e("title"))},[$(e.$slots,"title",{},(()=>[x(N(e.title),1)]))],2),v("div",{class:C(c(a).e("extra"))},[$(e.$slots,"extra",{},(()=>[x(N(e.extra),1)]))],2)],2)):V("v-if",!0),v("div",{class:C(c(a).e("body"))},[v("table",{class:C([c(a).e("table"),c(a).is("bordered",e.border)])},[v("tbody",null,[(d(!0),p(m,null,g(o(),((e,l)=>(d(),f(ie,{key:l,row:e},null,8,["row"])))),128))])],2)],2)],2))}}),[["__file","description.vue"]]);const ce=e({name:"ElDescriptionsItem",props:o({label:{type:String,default:""},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},labelWidth:{type:[String,Number],default:""},align:{type:String,default:"left"},labelAlign:{type:String,default:""},className:{type:String,default:""},labelClassName:{type:String,default:""}})}),de=j(ue,{DescriptionsItem:ce}),pe=E(ce),ve=o({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:W}}),me={click:e=>e instanceof MouseEvent},ge=e({name:"ElLink"});const fe=j(b(e({...ge,props:ve,emits:me,setup(e,{emit:l}){const a=e,t=s("link"),n=S((()=>[t.b(),t.m(a.type),t.is("disabled",a.disabled),t.is("underline",a.underline&&!a.disabled)]));function i(e){a.disabled||l("click",e)}return(e,l)=>(d(),p("a",{class:C(c(n)),href:e.disabled||!e.href?void 0:e.href,target:e.disabled||!e.href?void 0:e.target,onClick:i},[e.icon?(d(),f(c(U),{key:0},{default:D((()=>[(d(),f(I(e.icon)))])),_:1})):V("v-if",!0),e.$slots.default?(d(),p("span",{key:1,class:C(c(t).e("inner"))},[$(e.$slots,"default")],2)):V("v-if",!0),e.$slots.icon?$(e.$slots,"icon",{key:2}):V("v-if",!0)],10,["href","target"]))}}),[["__file","link.vue"]])),he={class:"complaint-management"},be={class:"page-header"},ye={class:"header-left"},_e=(e=>(K("data-v-4a2fc1a3"),e=e(),O(),e))((()=>v("h1",{class:"page-title"},"投诉管理",-1))),we={key:0,class:"success-message"},ke={class:"search-container"},Se={class:"search-form"},Ce={class:"table-container"},$e={class:"pagination-container"},xe={key:0,class:"complaint-detail"},Ne={class:"complaint-type-text"},Ve={class:"content-text"},ze={class:"image-gallery"},je={class:"image-gallery-large"},Ee=X(e({__name:"ComplaintManagement",setup(e){const l="https://qywx.menghuaa.cn/",a=B(!1),t=B(""),s=B([]),i=B(!1),r=B(!1),o=B(null),u=B([]),c=B(0),b=A({channelName:"",status:""}),y=A({page:1,limit:20,total:0});M((()=>{_()}));const _=async()=>{try{a.value=!0;const e={page:y.page,limit:y.limit,...b},l=await P.getComplaints(e);s.value=l.list,y.total=l.total}catch(e){q.error("加载投诉列表失败")}finally{a.value=!1}},w=()=>{y.page=1,_()},k=()=>{b.channelName="",b.status="",y.page=1,_()},S=e=>{y.limit=e,y.page=1,_()},C=e=>{y.page=e,_()},$=e=>"string"==typeof e?e.startsWith("http")?e:`${l}${e}`:e&&e.url?e.url.startsWith("http")?e.url:`${l}${e.url}`:"",z=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},j=e=>({pending:"待处理",processing:"处理中",resolved:"已解决",rejected:"已拒绝"}[e]||e);return(e,E)=>{const W=L,I=R,U=T,B=F,A=Y,M=fe,K=Z,O=J,X=pe,ae=H,te=Q,se=de,ne=le,ie=ee;return d(),p("div",he,[v("div",be,[v("div",ye,[_e,t.value?(d(),p("div",we,N(t.value),1)):V("",!0)])]),v("div",ke,[v("div",Se,[h(W,{modelValue:b.channelName,"onUpdate:modelValue":E[0]||(E[0]=e=>b.channelName=e),placeholder:"请输入通道名称",class:"search-input",clearable:""},null,8,["modelValue"]),h(U,{modelValue:b.status,"onUpdate:modelValue":E[1]||(E[1]=e=>b.status=e),placeholder:"请选择处理状态",class:"search-select",clearable:""},{default:D((()=>[h(I,{label:"全部",value:""}),h(I,{label:"待处理",value:"pending"}),h(I,{label:"处理中",value:"processing"}),h(I,{label:"已解决",value:"resolved"}),h(I,{label:"已拒绝",value:"rejected"})])),_:1},8,["modelValue"]),h(B,{type:"primary",onClick:w},{default:D((()=>[x("搜索")])),_:1}),h(B,{onClick:k},{default:D((()=>[x("重置")])),_:1})])]),v("div",Ce,[n((d(),f(K,{data:s.value,class:"complaints-table",stripe:""},{default:D((()=>[h(A,{prop:"id",label:"投诉ID",width:"100"}),h(A,{prop:"channel_id",label:"投诉通道",width:"120"},{default:D((({row:e})=>{var l;return[v("p",null,N(null==(l=null==e?void 0:e.channel)?void 0:l.channel_name),1)]})),_:1}),h(A,{prop:"contact",label:"投诉人手机号",width:"150"}),h(A,{prop:"complaint_type",label:"投诉类型",width:"150","show-overflow-tooltip":""}),h(A,{label:"投诉内容"},{default:D((({row:e})=>[v("p",null,[v("p",null,[x(N(e.complaint_content)+" ",1),e.image_urls&&e.image_urls.length>0?(d(),f(M,{key:0,type:"primary",onClick:a=>(e=>{var a;u.value=null==(a=e.image_urls)?void 0:a.map((e=>l+e.url)),r.value=!0})(e)},{default:D((()=>[x(" 有图片 ")])),_:2},1032,["onClick"])):V("",!0)])])])),_:1}),h(A,{label:"处理状态",width:"150"},{default:D((({row:e})=>[h(U,{modelValue:e.processing_status,"onUpdate:modelValue":l=>e.processing_status=l,onChange:l=>(async e=>{try{await P.updateComplaintStatus(e.id,{status:e.processing_status}),q.success("状态更新成功"),_()}catch(l){q.error("更新状态失败"),_()}})(e),class:"status-select"},{default:D((()=>[h(I,{label:"待处理",value:"pending"}),h(I,{label:"处理中",value:"processing"}),h(I,{label:"已解决",value:"resolved"}),h(I,{label:"已拒绝",value:"rejected"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),h(A,{prop:"submitted_at",label:"投诉时间",width:"150"},{default:D((({row:e})=>[x(N(z(e.submitted_at)),1)])),_:1}),h(A,{label:"操作",width:"180",fixed:"right"},{default:D((({row:e})=>[h(B,{type:"primary",size:"small",onClick:l=>(async e=>{try{const l=await P.getComplaint(e.id);o.value=l,c.value=l.complaint_count||0,i.value=!0}catch(l){q.error("获取投诉详情失败")}})(e)},{default:D((()=>[x(" 查看详情 ")])),_:2},1032,["onClick"]),h(B,{type:"danger",size:"small",onClick:l=>(async e=>{try{await G.confirm(`确定要删除投诉 ${e.id} 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P.deleteComplaint(e.id),q.success("删除成功"),_()}catch(l){"cancel"!==l&&q.error("删除投诉失败")}})(e)},{default:D((()=>[x(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ie,a.value]]),v("div",$e,[h(O,{"current-page":y.page,"onUpdate:currentPage":E[2]||(E[2]=e=>y.page=e),"page-size":y.limit,"onUpdate:pageSize":E[3]||(E[3]=e=>y.limit=e),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:C},null,8,["current-page","page-size","total"])])]),h(ne,{modelValue:i.value,"onUpdate:modelValue":E[5]||(E[5]=e=>i.value=e),title:"投诉详情",width:"800px","close-on-click-modal":!1},{footer:D((()=>[h(B,{onClick:E[4]||(E[4]=e=>i.value=!1)},{default:D((()=>[x("关闭")])),_:1})])),default:D((()=>[o.value?(d(),p("div",xe,[h(se,{column:2,border:""},{default:D((()=>[h(X,{label:"投诉编号"},{default:D((()=>[x(N(o.value.complaint_id_str||o.value.id),1)])),_:1}),h(X,{label:"投诉时间"},{default:D((()=>[x(N(z(o.value.submitted_at)),1)])),_:1}),h(X,{label:"员工姓名"},{default:D((()=>{var e;return[x(N((null==(e=o.value.channel)?void 0:e.channel_name)||"未知"),1)]})),_:1}),h(X,{label:"所属部门"},{default:D((()=>{var e;return[x(N((null==(e=o.value.channel)?void 0:e.channel_code)||"未知"),1)]})),_:1}),h(X,{label:"投诉人手机"},{default:D((()=>[x(N(o.value.contact),1)])),_:1}),h(X,{label:"通道累计投诉次数"},{default:D((()=>[x(N(c.value||"0次"),1)])),_:1}),h(X,{label:"投诉人IP"},{default:D((()=>[x(N(o.value.submitter_ip||"未知"),1)])),_:1}),h(X,{label:"IP归属地"},{default:D((()=>[x(N(o.value.ip_location||"未知"),1)])),_:1}),h(X,{label:"办理状态"},{default:D((()=>{return[h(ae,{type:(e=o.value.processing_status,{pending:"warning",processing:"info",resolved:"success",rejected:"danger"}[e]||"info")},{default:D((()=>[x(N(j(o.value.processing_status)),1)])),_:1},8,["type"])];var e})),_:1}),h(X,{label:"投诉类型",span:2},{default:D((()=>[v("div",Ne,N(o.value.complaint_type),1)])),_:1}),h(X,{label:"投诉内容",span:2},{default:D((()=>[v("div",Ve,N(o.value.complaint_content),1)])),_:1}),o.value.image_urls&&o.value.image_urls.length>0?(d(),f(X,{key:0,label:"相关截图",span:2},{default:D((()=>[v("div",ze,[(d(!0),p(m,null,g(o.value.image_urls,((e,l)=>(d(),f(te,{key:l,src:$(e),"preview-src-list":o.value.image_urls.map((e=>$(e))),class:"evidence-image",fit:"cover"},null,8,["src","preview-src-list"])))),128))])])),_:1})):V("",!0)])),_:1})])):V("",!0)])),_:1},8,["modelValue"]),h(ne,{modelValue:r.value,"onUpdate:modelValue":E[6]||(E[6]=e=>r.value=e),title:"图片证据",width:"80%","close-on-click-modal":!1},{default:D((()=>[v("div",je,[(d(!0),p(m,null,g(u.value,((e,l)=>(d(),f(te,{key:l,src:e,"preview-src-list":u.value,class:"evidence-image-large",fit:"contain"},null,8,["src","preview-src-list"])))),128))])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-4a2fc1a3"]]);export{Ee as default};
