import{d as e,A as a,r as l,b as t,V as o,c as i,$ as s,w as d,f as n,g as r,j as u,t as m,l as c,E as p,aE as g,aF as f,n as v,m as h,s as _,q as y,_ as w,o as b,e as V,h as k,ax as z,F as C,I as x,aB as N,aI as P,aG as T,G as D,aK as E,v as U,x as A,aM as R,aN as j,aO as B,aL as S}from"./index-1c523516.js";import{E as Z,a as I,b as $,v as q}from"./table-column-09edd8b4.js";import{E as O}from"./overlay-43116231.js";const F={class:"dialog-footer"},G=w(e({__name:"DomainDialog",props:{modelValue:{type:Boolean},domainData:{default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(e,{emit:w}){const b=e,V=w,k=a({get:()=>b.modelValue,set:e=>V("update:modelValue",e)}),z=l(),C=l(!1),x=t({protocol:"https",domainName:"",domainRemark:""}),N={protocol:[{required:!0,message:"请选择域名协议",trigger:"change"}],domainName:[{required:!0,message:"请输入授权域名",trigger:"blur"},{pattern:/^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/,message:"请输入正确的域名格式",trigger:"blur"}]};o((()=>b.domainData),(e=>{e&&Object.assign(x,{protocol:e.protocol||"https",domainName:e.domainName||"",domainRemark:e.domainRemark||""})}),{immediate:!0});const P=()=>{k.value=!1,T()},T=()=>{var e;Object.assign(x,{protocol:"https",domainName:"",domainRemark:""}),null==(e=z.value)||e.clearValidate()},D=async()=>{if(z.value)try{await z.value.validate(),C.value=!0,b.isEdit?(await c.updateTenantDomain(b.domainData.id,x),p.success("修改成功")):(await c.createTenantDomain(x),p.success("添加成功")),V("success"),P()}catch(e){p.error(e.message||"操作失败")}finally{C.value=!1}};return(e,a)=>{const l=g,t=f,o=v,c=h,p=_,w=y,b=O;return i(),s(b,{modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=e=>k.value=e),title:e.isEdit?"修改租户域名":"新建租户域名",width:"500px","close-on-click-modal":!1,"z-index":2e3,onClose:P},{footer:d((()=>[n("div",F,[r(w,{onClick:P},{default:d((()=>[u("取消")])),_:1}),r(w,{type:"primary",loading:C.value,onClick:D},{default:d((()=>[u(m((e.isEdit,"确定保存")),1)])),_:1},8,["loading"])])])),default:d((()=>[r(p,{ref_key:"formRef",ref:z,model:x,rules:N,"label-width":"100px"},{default:d((()=>[r(o,{label:"域名协议",prop:"protocol"},{default:d((()=>[r(t,{modelValue:x.protocol,"onUpdate:modelValue":a[0]||(a[0]=e=>x.protocol=e)},{default:d((()=>[r(l,{value:"http"},{default:d((()=>[u("HTTP")])),_:1}),r(l,{value:"https"},{default:d((()=>[u("HTTPS")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(o,{label:"授权域名",prop:"domainName"},{default:d((()=>[r(c,{modelValue:x.domainName,"onUpdate:modelValue":a[1]||(a[1]=e=>x.domainName=e),placeholder:e.isEdit?"请输入授权域名":"请设置授权域名",clearable:""},null,8,["modelValue","placeholder"])])),_:1}),r(o,{label:"域名备注",prop:"domainRemark"},{default:d((()=>[r(c,{modelValue:x.domainRemark,"onUpdate:modelValue":a[2]||(a[2]=e=>x.domainRemark=e),placeholder:e.isEdit?"请输入域名备注":"请设置域名备注",clearable:""},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-72d64f76"]]),H={class:"domain-binding"},L=(e=>(U("data-v-20f35245"),e=e(),A(),e))((()=>n("div",{class:"page-header"},[n("h2",{class:"page-title"},"域名绑定"),n("p",{class:"page-subtitle"},"绑定当前租户的域名信息")],-1))),K={class:"search-section"},M={class:"action-section"},J={class:"table-section"},Q={class:"pagination-section"},W=w(e({__name:"index",setup(e){const a=t({isPreset:void 0,domainName:""}),o=l([]),g=l([]),f=l(!1),w=t({page:1,limit:20,total:0}),U=l(!1),A=l(null),O=l(!1),F=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},W=async()=>{try{f.value=!0;const e={page:w.page,limit:w.limit,...a},l=await c.getTenantDomains(e);l&&(o.value=l.list||[],w.total=l.total||0)}catch(e){p.error("获取域名列表失败")}finally{f.value=!1}},X=()=>{w.page=1,W()},Y=()=>{a.isPreset=void 0,a.domainName="",w.page=1,W()},ee=e=>{g.value=e.filter((e=>!e.isPreset))},ae=()=>{A.value=null,O.value=!1,U.value=!0},le=async()=>{if(0!==g.value.length)try{await N.confirm(`确定要删除选中的 ${g.value.length} 个域名吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=g.value.map((e=>e.id));await c.batchDeleteTenantDomains(e),p.success("批量删除成功"),W()}catch(e){"cancel"!==e&&p.error("批量删除失败")}else p.warning("请选择要删除的域名")},te=()=>{U.value=!1,W()},oe=e=>{w.limit=e,w.page=1,W()},ie=e=>{w.page=e,W()};return b((()=>{W()})),(e,l)=>{const t=P,b=T,se=v,de=h,ne=D,re=y,ue=_,me=Z,ce=E,pe=I,ge=$,fe=q;return i(),V("div",H,[L,n("div",K,[r(ue,{model:a,inline:""},{default:d((()=>[r(se,{label:"预设域名"},{default:d((()=>[r(b,{modelValue:a.isPreset,"onUpdate:modelValue":l[0]||(l[0]=e=>a.isPreset=e),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:d((()=>[r(t,{label:"是",value:1}),r(t,{label:"否",value:0})])),_:1},8,["modelValue"])])),_:1}),r(se,{label:"授权域名"},{default:d((()=>[r(de,{modelValue:a.domainName,"onUpdate:modelValue":l[1]||(l[1]=e=>a.domainName=e),placeholder:"请输入授权域名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])])),_:1}),r(se,null,{default:d((()=>[r(re,{type:"primary",onClick:X},{default:d((()=>[r(ne,null,{default:d((()=>[r(k(R))])),_:1}),u(" 查询 ")])),_:1}),r(re,{onClick:Y},{default:d((()=>[r(ne,null,{default:d((()=>[r(k(j))])),_:1}),u(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])]),n("div",M,[r(re,{type:"danger",disabled:0===g.value.length,onClick:le},{default:d((()=>[r(ne,null,{default:d((()=>[r(k(B))])),_:1}),u(" 批量删除 ")])),_:1},8,["disabled"]),r(re,{type:"primary",onClick:ae},{default:d((()=>[r(ne,null,{default:d((()=>[r(k(S))])),_:1}),u(" 添加租户域名 ")])),_:1})]),n("div",J,[z((i(),s(pe,{data:o.value,onSelectionChange:ee,stripe:"",border:"",style:{width:"100%"}},{default:d((()=>[r(me,{type:"selection",width:"55"}),r(me,{prop:"protocol",label:"域名协议",width:"100"},{default:d((({row:e})=>[r(ce,{type:"https"===e.protocol?"success":"warning",size:"small"},{default:d((()=>[u(m(e.protocol.toUpperCase()),1)])),_:2},1032,["type"])])),_:1}),r(me,{prop:"domainName",label:"授权域名","min-width":"200"}),r(me,{prop:"domainRemark",label:"域名备注","min-width":"150"}),r(me,{label:"预设域名",width:"100"},{default:d((({row:e})=>[r(ce,{type:e.isPreset?"success":"danger",size:"small"},{default:d((()=>[u(m(e.isPreset?"是":"否"),1)])),_:2},1032,["type"])])),_:1}),r(me,{prop:"createdAt",label:"创建时间",width:"180"},{default:d((({row:e})=>[u(m(F(e.createdAt)),1)])),_:1}),r(me,{label:"操作",width:"150",fixed:"right"},{default:d((({row:e})=>[e.isPreset?x("",!0):(i(),V(C,{key:0},[r(re,{type:"warning",size:"small",onClick:a=>(e=>{e.isPreset?p.warning("预设域名不允许修改"):(A.value={...e},O.value=!0,U.value=!0)})(e)},{default:d((()=>[u(" 修改 ")])),_:2},1032,["onClick"]),r(re,{type:"danger",size:"small",onClick:a=>(async e=>{if(e.isPreset)p.warning("预设域名不允许删除");else try{await N.confirm(`确定要删除域名 "${e.domainName}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.deleteTenantDomain(e.id),p.success("删除成功"),W()}catch(a){"cancel"!==a&&p.error("删除失败")}})(e)},{default:d((()=>[u(" 删除 ")])),_:2},1032,["onClick"])],64))])),_:1})])),_:1},8,["data"])),[[fe,f.value]])]),n("div",Q,[r(ge,{"current-page":w.page,"onUpdate:currentPage":l[2]||(l[2]=e=>w.page=e),"page-size":w.limit,"onUpdate:pageSize":l[3]||(l[3]=e=>w.limit=e),"page-sizes":[10,20,50,100],total:w.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ie},null,8,["current-page","page-size","total"])]),r(G,{modelValue:U.value,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value=e),"domain-data":A.value,"is-edit":O.value,onSuccess:te},null,8,["modelValue","domain-data","is-edit"])])}}}),[["__scopeId","data-v-20f35245"]]);export{W as default};
