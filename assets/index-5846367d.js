import{d as e,R as a,r as l,b as t,V as r,c as n,$ as o,w as m,f as s,g as i,j as d,t as u,l as c,E as p,m as b,n as f,aI as h,aG as g,aP as v,aE as V,aF as _,s as y,q as w,_ as C,o as U,e as x,h as T,ax as D,aB as k,D as N,aK as z,aM as B,aN as I,aO as S}from"./index-62a62fdc.js";import{E as j,a as E,b as A,v as R}from"./table-column-988e3ed3.js";import{E as M}from"./avatar-8c188ce5.js";import{E as O}from"./card-d9ae0c11.js";import{E as W}from"./overlay-297c2f61.js";const q={class:"dialog-footer"},$=C(e({__name:"MemberDialog",props:{modelValue:{type:Boolean},memberData:{default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(e,{emit:C}){const U=e,x=C,T=a({get:()=>U.modelValue,set:e=>x("update:modelValue",e)}),D=l(),k=l(!1),N=t({memberId:"",memberName:"",department:"",position:"",mobile:"",email:"",avatarUrl:"",complaintChannel:"未设置",sourceApplication:"",externalDataUpdateTime:null,status:1,remark:""}),z={memberId:[{required:!0,message:"请输入成员ID",trigger:"blur"}],memberName:[{required:!0,message:"请输入成员姓名",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]};r((()=>U.memberData),(e=>{e&&Object.assign(N,{memberId:e.memberId||"",memberName:e.memberName||"",department:e.department||"",position:e.position||"",mobile:e.mobile||"",email:e.email||"",avatarUrl:e.avatarUrl||"",complaintChannel:e.complaintChannel||"未设置",sourceApplication:e.sourceApplication||"",externalDataUpdateTime:e.externalDataUpdateTime?new Date(e.externalDataUpdateTime):null,status:void 0!==e.status?e.status:1,remark:e.remark||""})}),{immediate:!0});const B=()=>{T.value=!1,I()},I=()=>{var e;Object.assign(N,{memberId:"",memberName:"",department:"",position:"",mobile:"",email:"",avatarUrl:"",complaintChannel:"未设置",sourceApplication:"",externalDataUpdateTime:null,status:1,remark:""}),null==(e=D.value)||e.clearValidate()},S=async()=>{if(D.value)try{await D.value.validate(),k.value=!0;const e={...N,externalDataUpdateTime:N.externalDataUpdateTime?N.externalDataUpdateTime.toISOString():null};let a;a=U.isEdit?await c.updateWechatMember(U.memberData.id,e):await c.createWechatMember(e),p.success(U.isEdit?"修改成功":"添加成功"),x("success"),B()}catch(e){p.error(e.message||"操作失败")}finally{k.value=!1}};return(e,a)=>{const l=b,t=f,r=h,c=g,p=v,C=V,U=_,x=y,I=w,j=W;return n(),o(j,{modelValue:T.value,"onUpdate:modelValue":a[12]||(a[12]=e=>T.value=e),title:e.isEdit?"编辑成员":"添加成员",width:"600px","close-on-click-modal":!1,"z-index":2e3,onClose:B},{footer:m((()=>[s("div",q,[i(I,{onClick:B},{default:m((()=>[d("取消")])),_:1}),i(I,{type:"primary",loading:k.value,onClick:S},{default:m((()=>[d(u(e.isEdit?"确定保存":"确定添加"),1)])),_:1},8,["loading"])])])),default:m((()=>[i(x,{ref_key:"formRef",ref:D,model:N,rules:z,"label-width":"120px"},{default:m((()=>[i(t,{label:"成员ID",prop:"memberId"},{default:m((()=>[i(l,{modelValue:N.memberId,"onUpdate:modelValue":a[0]||(a[0]=e=>N.memberId=e),placeholder:"请输入成员ID",clearable:"",class:"form-input",disabled:e.isEdit},null,8,["modelValue","disabled"])])),_:1}),i(t,{label:"成员姓名",prop:"memberName"},{default:m((()=>[i(l,{modelValue:N.memberName,"onUpdate:modelValue":a[1]||(a[1]=e=>N.memberName=e),placeholder:"请输入成员姓名",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"部门",prop:"department"},{default:m((()=>[i(l,{modelValue:N.department,"onUpdate:modelValue":a[2]||(a[2]=e=>N.department=e),placeholder:"请输入部门",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"职位",prop:"position"},{default:m((()=>[i(l,{modelValue:N.position,"onUpdate:modelValue":a[3]||(a[3]=e=>N.position=e),placeholder:"请输入职位",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"手机号",prop:"mobile"},{default:m((()=>[i(l,{modelValue:N.mobile,"onUpdate:modelValue":a[4]||(a[4]=e=>N.mobile=e),placeholder:"请输入手机号",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"邮箱",prop:"email"},{default:m((()=>[i(l,{modelValue:N.email,"onUpdate:modelValue":a[5]||(a[5]=e=>N.email=e),placeholder:"请输入邮箱",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"头像URL",prop:"avatarUrl"},{default:m((()=>[i(l,{modelValue:N.avatarUrl,"onUpdate:modelValue":a[6]||(a[6]=e=>N.avatarUrl=e),placeholder:"请输入头像URL",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"投诉通道",prop:"complaintChannel"},{default:m((()=>[i(c,{modelValue:N.complaintChannel,"onUpdate:modelValue":a[7]||(a[7]=e=>N.complaintChannel=e),placeholder:"请选择投诉通道",clearable:"",style:{width:"100%"},class:"form-select"},{default:m((()=>[i(r,{label:"已配置",value:"已配置"}),i(r,{label:"未配置",value:"未配置"}),i(r,{label:"未设置",value:"未设置"})])),_:1},8,["modelValue"])])),_:1}),i(t,{label:"来源应用",prop:"sourceApplication"},{default:m((()=>[i(l,{modelValue:N.sourceApplication,"onUpdate:modelValue":a[8]||(a[8]=e=>N.sourceApplication=e),placeholder:"请输入来源应用",clearable:"",class:"form-input"},null,8,["modelValue"])])),_:1}),i(t,{label:"对外资料更新时间",prop:"externalDataUpdateTime"},{default:m((()=>[i(p,{modelValue:N.externalDataUpdateTime,"onUpdate:modelValue":a[9]||(a[9]=e=>N.externalDataUpdateTime=e),type:"datetime",placeholder:"请选择更新时间",style:{width:"100%"},class:"form-date"},null,8,["modelValue"])])),_:1}),i(t,{label:"状态",prop:"status"},{default:m((()=>[i(U,{modelValue:N.status,"onUpdate:modelValue":a[10]||(a[10]=e=>N.status=e),class:"status-radio-group"},{default:m((()=>[i(C,{value:1,class:"status-radio"},{default:m((()=>[d("正常")])),_:1}),i(C,{value:0,class:"status-radio"},{default:m((()=>[d("禁用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),i(t,{label:"备注",prop:"remark"},{default:m((()=>[i(l,{modelValue:N.remark,"onUpdate:modelValue":a[11]||(a[11]=e=>N.remark=e),type:"textarea",rows:3,placeholder:"请输入备注",class:"form-textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-a10692b2"]]),L={class:"member-info"},P={class:"member-details"},F={class:"member-name"},G={class:"member-department"},K={class:"dialog-footer"},H=C(e({__name:"ComplaintChannelDialog",props:{modelValue:{type:Boolean},memberData:{default:null}},emits:["update:modelValue","success"],setup(e,{emit:v}){const V=e,_=v,C=a({get:()=>V.modelValue,set:e=>_("update:modelValue",e)}),U=l(),x=l(!1),T=t({complaintChannel:"",description:""}),D={complaintChannel:[{required:!0,message:"请选择投诉通道",trigger:"change"}]};r((()=>V.memberData),(e=>{e&&(T.complaintChannel=e.complaintChannel||"未设置",T.description="")}),{immediate:!0});const k=()=>{C.value=!1,N()},N=()=>{var e;Object.assign(T,{complaintChannel:"",description:""}),null==(e=U.value)||e.clearValidate()},z=async()=>{if(U.value)try{await U.value.validate(),x.value=!0;const e=await c.updateWechatMemberComplaintChannel(V.memberData.id,{complaintChannel:T.complaintChannel});e.success?(p.success("配置投诉通道成功"),_("success"),k()):p.error(e.message||"配置失败")}catch(e){p.error(e.message||"配置失败")}finally{x.value=!1}};return(e,a)=>{const l=M,t=h,r=g,c=f,p=b,v=y,V=w,_=W;return n(),o(_,{modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value=e),title:"配置投诉通道",width:"500px","close-on-click-modal":!1,"z-index":2e3,onClose:k},{footer:m((()=>[s("div",K,[i(V,{onClick:k},{default:m((()=>[d("取消")])),_:1}),i(V,{type:"primary",loading:x.value,onClick:z},{default:m((()=>[d(" 确定配置 ")])),_:1},8,["loading"])])])),default:m((()=>{var n,o,b,f;return[s("div",L,[i(l,{size:48,src:null==(n=e.memberData)?void 0:n.avatarUrl,class:"member-avatar"},{default:m((()=>{var a,l;return[d(u(null==(l=null==(a=e.memberData)?void 0:a.memberName)?void 0:l.charAt(0)),1)]})),_:1},8,["src"]),s("div",P,[s("h3",F,u(null==(o=e.memberData)?void 0:o.memberName),1),s("p",G,u(null==(b=e.memberData)?void 0:b.department)+" - "+u(null==(f=e.memberData)?void 0:f.position),1)])]),i(v,{ref_key:"formRef",ref:U,model:T,rules:D,"label-width":"120px",class:"complaint-form"},{default:m((()=>[i(c,{label:"投诉通道",prop:"complaintChannel"},{default:m((()=>[i(r,{modelValue:T.complaintChannel,"onUpdate:modelValue":a[0]||(a[0]=e=>T.complaintChannel=e),placeholder:"请选择投诉通道",clearable:"",style:{width:"100%"},class:"form-select"},{default:m((()=>[i(t,{label:"已配置",value:"已配置"}),i(t,{label:"未配置",value:"未配置"}),i(t,{label:"未设置",value:"未设置"})])),_:1},8,["modelValue"])])),_:1}),i(c,{label:"配置说明",prop:"description"},{default:m((()=>[i(p,{modelValue:T.description,"onUpdate:modelValue":a[1]||(a[1]=e=>T.description=e),type:"textarea",rows:3,placeholder:"请输入配置说明（可选）",class:"form-textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])]})),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-24da39d0"]]),J={class:"wechat-members"},Q={class:"search-section"},X={class:"action-section"},Y={class:"action-buttons-left"},Z={class:"action-buttons-right"},ee={class:"table-section"},ae={class:"member-info"},le={class:"member-name"},te={key:0},re={key:1,class:"text-muted"},ne={class:"pagination-section"},oe=C(e({__name:"index",setup(e){const a=l(!1),r=l(!1),V=l(!1),_=l(!1),C=l(!1),W=l(null),q=l([]),L=l([]),P=t({memberName:"",department:"",complaintChannel:"",dateRange:null,startTime:"",endTime:""}),F=t({page:1,pageSize:10,total:0}),G=e=>{switch(e){case"已配置":return"success";case"未配置":return"warning";default:return"info"}},K=e=>e?new Date(e).toLocaleString("zh-CN"):"-",oe=e=>{e&&2===e.length?(P.startTime=e[0],P.endTime=e[1]):(P.startTime="",P.endTime="")},me=async()=>{try{a.value=!0;const e={page:F.page,pageSize:F.pageSize,memberName:P.memberName,department:P.department,complaintChannel:P.complaintChannel,startTime:P.startTime,endTime:P.endTime},l=await c.getWechatMembers(e);L.value=l.list,F.total=l.total}catch(e){p.error("获取成员列表失败")}finally{a.value=!1}},se=()=>{F.page=1,me()},ie=()=>{Object.assign(P,{memberName:"",department:"",complaintChannel:"",dateRange:null,startTime:"",endTime:""}),F.page=1,me()},de=async()=>{try{await k.confirm(`确定要删除选中的 ${q.value.length} 个成员吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=q.value.map((e=>e.id)),a=await c.batchDeleteWechatMembers(e);a.success?(p.success(a.message||"批量删除成功"),me()):p.error(a.message||"批量删除失败")}catch(e){"cancel"!==e&&p.error("批量删除失败")}},ue=e=>{q.value=e},ce=async()=>{try{await k.confirm("确定要清理所有成员的可信评定吗？","清理可信评定",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),p.success("清理可信评定成功"),me()}catch(e){"cancel"!==e&&p.error("清理可信评定失败")}},pe=async()=>{try{await k.confirm("确定要设置企业可信评定吗？","设置企业可信评定",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),p.success("设置企业可信评定成功"),me()}catch(e){"cancel"!==e&&p.error("设置企业可信评定失败")}},be=async()=>{try{await k.confirm("确定要清理所有成员的投诉连接吗？","清理投诉连接",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),p.success("清理投诉连接成功"),me()}catch(e){"cancel"!==e&&p.error("清理投诉连接失败")}},fe=async()=>{try{await k.confirm("确定要更新所有成员的投诉连接吗？","更新投诉连接",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),p.success("更新投诉连接成功"),me()}catch(e){"cancel"!==e&&p.error("更新投诉连接失败")}},he=async()=>{try{r.value=!0,await new Promise((e=>setTimeout(e,2e3))),p.success("同步成员企微成员成功"),me()}catch(e){p.error("同步成员企微成员失败")}finally{r.value=!1}},ge=e=>{F.pageSize=e,F.page=1,me()},ve=e=>{F.page=e,me()},Ve=()=>{V.value=!1,me()},_e=()=>{_.value=!1,me()};return U((()=>{me()})),(e,l)=>{const t=b,U=f,ye=h,we=g,Ce=v,Ue=N,xe=w,Te=y,De=O,ke=j,Ne=M,ze=z,Be=E,Ie=A,Se=R;return n(),x("div",J,[s("div",Q,[i(De,{class:"search-card"},{default:m((()=>[i(Te,{model:P,inline:"",class:"search-form"},{default:m((()=>[i(U,{label:"成员姓名"},{default:m((()=>[i(t,{modelValue:P.memberName,"onUpdate:modelValue":l[0]||(l[0]=e=>P.memberName=e),placeholder:"请输入成员姓名",clearable:"",class:"search-input"},null,8,["modelValue"])])),_:1}),i(U,{label:"部门"},{default:m((()=>[i(t,{modelValue:P.department,"onUpdate:modelValue":l[1]||(l[1]=e=>P.department=e),placeholder:"请输入部门",clearable:"",class:"search-input"},null,8,["modelValue"])])),_:1}),i(U,{label:"投诉通道配置状态"},{default:m((()=>[i(we,{modelValue:P.complaintChannel,"onUpdate:modelValue":l[2]||(l[2]=e=>P.complaintChannel=e),placeholder:"请选择状态",clearable:"",class:"search-select"},{default:m((()=>[i(ye,{label:"已配置",value:"已配置"}),i(ye,{label:"未配置",value:"未配置"}),i(ye,{label:"未设置",value:"未设置"})])),_:1},8,["modelValue"])])),_:1}),i(U,{label:"配置日期"},{default:m((()=>[i(Ce,{modelValue:P.dateRange,"onUpdate:modelValue":l[3]||(l[3]=e=>P.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",class:"search-date",onChange:oe},null,8,["modelValue"])])),_:1}),i(U,null,{default:m((()=>[i(xe,{type:"primary",onClick:se,class:"search-button"},{default:m((()=>[i(Ue,null,{default:m((()=>[i(T(B))])),_:1}),d(" 查询 ")])),_:1}),i(xe,{onClick:ie,class:"reset-button"},{default:m((()=>[i(Ue,null,{default:m((()=>[i(T(I))])),_:1}),d(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})]),s("div",X,[s("div",Y,[i(xe,{type:"warning",onClick:ce},{default:m((()=>[d(" 清理可信评定 ")])),_:1}),i(xe,{type:"primary",onClick:pe},{default:m((()=>[d(" 设置企业可信评定 ")])),_:1}),i(xe,{type:"warning",onClick:be},{default:m((()=>[d(" 清理投诉连接 ")])),_:1}),i(xe,{type:"primary",onClick:fe},{default:m((()=>[d(" 更新投诉连接 ")])),_:1})]),s("div",Z,[i(xe,{type:"danger",disabled:0===q.value.length,onClick:de},{default:m((()=>[i(Ue,null,{default:m((()=>[i(T(S))])),_:1}),d(" 批量删除 ")])),_:1},8,["disabled"]),i(xe,{type:"primary",onClick:he,loading:r.value,class:"sync-members-button"},{default:m((()=>[i(Ue,null,{default:m((()=>[i(T(I))])),_:1}),d(" 同步成员企微成员 ")])),_:1},8,["loading"])])]),s("div",ee,[D((n(),o(Be,{data:L.value,onSelectionChange:ue,class:"members-table",stripe:""},{default:m((()=>[i(ke,{type:"selection",width:"55"}),i(ke,{prop:"memberName",label:"成员姓名","min-width":"120"},{default:m((({row:e})=>[s("div",ae,[i(Ne,{size:32,src:e.avatarUrl,class:"member-avatar"},{default:m((()=>[d(u(e.memberName.charAt(0)),1)])),_:2},1032,["src"]),s("span",le,u(e.memberName),1)])])),_:1}),i(ke,{prop:"department",label:"部门","min-width":"120"}),i(ke,{prop:"position",label:"职位","min-width":"120"}),i(ke,{prop:"complaintChannel",label:"投诉通道","min-width":"120"},{default:m((({row:e})=>[i(ze,{type:G(e.complaintChannel),size:"small"},{default:m((()=>[d(u(e.complaintChannel),1)])),_:2},1032,["type"])])),_:1}),i(ke,{prop:"externalDataUpdateTime",label:"对外资料更新时间","min-width":"160"},{default:m((({row:e})=>[e.externalDataUpdateTime?(n(),x("span",te,u(K(e.externalDataUpdateTime)),1)):(n(),x("span",re,"未设置"))])),_:1}),i(ke,{prop:"syncTime",label:"同步时间","min-width":"160"},{default:m((({row:e})=>[d(u(K(e.syncTime)),1)])),_:1}),i(ke,{prop:"sourceApplication",label:"来源应用","min-width":"150"}),i(ke,{prop:"status",label:"状态",width:"80"},{default:m((({row:e})=>[i(ze,{type:1===e.status?"success":"danger",size:"small"},{default:m((()=>[d(u(1===e.status?"正常":"禁用"),1)])),_:2},1032,["type"])])),_:1}),i(ke,{label:"操作",width:"200",fixed:"right"},{default:m((({row:e})=>[i(xe,{type:"danger",size:"small",link:"",onClick:a=>(async e=>{try{await k.confirm(`确定要删除成员 "${e.memberName}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.deleteWechatMember(e.id),p.success("删除成功"),me()}catch(a){"cancel"!==a&&p.error("删除失败")}})(e),class:"action-button"},{default:m((()=>[d(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Se,a.value]])]),s("div",ne,[i(Ie,{"current-page":F.page,"onUpdate:currentPage":l[4]||(l[4]=e=>F.page=e),"page-size":F.pageSize,"onUpdate:pageSize":l[5]||(l[5]=e=>F.pageSize=e),total:F.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ge,onCurrentChange:ve,class:"pagination"},null,8,["current-page","page-size","total"])]),i($,{modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=e=>V.value=e),"member-data":W.value,"is-edit":C.value,onSuccess:Ve},null,8,["modelValue","member-data","is-edit"]),i(H,{modelValue:_.value,"onUpdate:modelValue":l[7]||(l[7]=e=>_.value=e),"member-data":W.value,onSuccess:_e},null,8,["modelValue","member-data"])])}}}),[["__scopeId","data-v-9df9720f"]]);export{oe as default};
