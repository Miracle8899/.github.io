import{d as e,r as a,b as l,o as n,l as t,E as s,c,e as i,f as u,t as o,H as r,g as d,w as p,h as m,j as h,ax as v,$ as _,F as f,B as g,aB as y,D as b,q as w,aK as C,m as V,n as k,s as x,aI as z,aG as U,v as $,x as j,aU as S,aL as T,aV as X,aW as F,aX as q,_ as B}from"./index-62a62fdc.js";import{E,a as I,b as R,v as A}from"./table-column-988e3ed3.js";import{E as D}from"./overlay-297c2f61.js";const G=e=>($("data-v-daeae861"),e=e(),j(),e),H={class:"channels-page"},K={class:"page-header"},L={class:"header-left"},P=G((()=>u("h1",{class:"page-title"},"通道管理",-1))),W={key:0,class:"success-message"},J={class:"header-actions"},M={class:"table-container"},N={class:"channel-link"},O={class:"link-text"},Q=G((()=>u("span",{class:"link-warning"},"(禁止发到微信对话框直接点击访问)",-1))),Y={class:"pagination-container"},Z={class:"batch-create-content"},ee={class:"batch-create-hint"},ae=G((()=>u("span",null,"每行一个通道名称,系统将自动为每个通道生成唯一的短链和落地页",-1))),le={class:"batch-create-instructions"},ne={class:"instructions-header"},te=G((()=>u("span",null,"批量创建说明",-1))),se=G((()=>u("ul",{class:"instructions-list"},[u("li",null,"每行输入一个通道名称"),u("li",null,"空行将被自动忽略"),u("li",null,"系统将自动生成短链和落地页"),u("li",null,"建议一次创建不超过10个通道")],-1))),ce={class:"batch-copy-content"},ie={class:"copy-actions"},ue=G((()=>u("div",{class:"channel-info-header"},[u("span",null,"通道信息列表")],-1))),oe={class:"channel-info-list"},re={class:"channel-name"},de={class:"channel-url"},pe={class:"copy-instructions"},me=G((()=>u("span",null,"点击上方按钮可以复制不同格式的所有通道信息 (自动获取全部数据,不受分页限制)",-1))),he=B(e({__name:"index",setup(e){const $=a(!1),j=a([]),B=a(""),G=a([]),he=l({page:1,pageSize:20,total:0}),ve=a(!1),_e=a(!1),fe=l({channel_name:"",description:""}),ge={channel_name:[{required:!0,message:"请输入通道名称",trigger:"blur"}]},ye=a(),be=a(!1),we=a(!1),Ce=l({id:null,channel_name:"",description:"",status:"enabled"}),Ve={channel_name:[{required:!0,message:"请输入通道名称",trigger:"blur"}]},ke=a(),xe=a(!1),ze=a(!1),Ue=l({channel_names:""}),$e=a(!1);n((()=>{document.title="通道管理",je()}));const je=async()=>{try{$.value=!0;const e=await t.getChannels({page:he.page,pageSize:he.pageSize});j.value=e.list,he.total=e.total}catch(e){s.error("加载通道列表失败: "+e.message)}finally{$.value=!1}},Se=()=>{fe.channel_name="",fe.description="",ve.value=!0},Te=async()=>{var e;try{await(null==(e=ye.value)?void 0:e.validate()),_e.value=!0;await t.createChannel({channel_name:fe.channel_name,description:fe.description});s.success("创建成功"),ve.value=!1,je()}catch(a){s.error("创建失败: "+a.message)}finally{_e.value=!1}},Xe=()=>{var e;ve.value=!1,null==(e=ye.value)||e.resetFields()},Fe=async()=>{var e;try{await(null==(e=ke.value)?void 0:e.validate()),we.value=!0;200===(await t.updateChannel(Ce.id,{channel_name:Ce.channel_name,description:Ce.description,status:Ce.status})).code&&(s.success("更新成功"),be.value=!1,je())}catch(a){s.error("更新失败: "+a.message)}finally{we.value=!1}},qe=()=>{var e;be.value=!1,null==(e=ke.value)||e.resetFields()},Be=()=>{Ue.channel_names="",xe.value=!0},Ee=async()=>{try{if(!Ue.channel_names.trim())return void s.warning("请输入通道名称");ze.value=!0;const e=Ue.channel_names.split("\n").map((e=>e.trim())).filter((e=>e));if(0===e.length)return void s.warning("请输入有效的通道名称");if(e.length>10)return void s.warning("一次最多只能创建10个通道");const a=(await t.batchCreateChannels({channel_names:e})).created.length;B.value=`成功创建${a}个通道`,s.success(`成功创建${a}个通道`),xe.value=!1,je(),setTimeout((()=>{B.value=""}),3e3)}catch(e){s.error("批量创建失败: "+e.message)}finally{ze.value=!1}},Ie=()=>{xe.value=!1,Ue.channel_names=""},Re=async()=>{try{const e=await t.exportAllChannels();200===e.code&&(G.value=e.data,$e.value=!0)}catch(e){s.error("获取通道信息失败: "+e.message)}},Ae=async()=>{try{const e=G.value.map(((e,a)=>`${a+1}. ${e.channel_name}\n${e.channel_url}`)).join("\n\n");await navigator.clipboard.writeText(e),s.success("已复制全部通道信息")}catch(e){s.error("复制失败")}},De=async()=>{try{const e=G.value.map(((e,a)=>`${a+1}. ${e.channel_name}`)).join("\n");await navigator.clipboard.writeText(e),s.success("已复制通道名称")}catch(e){s.error("复制失败")}},Ge=async()=>{try{const e=G.value.map(((e,a)=>`${a+1}. ${e.channel_url}`)).join("\n");await navigator.clipboard.writeText(e),s.success("已复制通道链接")}catch(e){s.error("复制失败")}},He=()=>{$e.value=!1,G.value=[]},Ke=e=>{he.pageSize=e,he.page=1,je()},Le=e=>{he.page=e,je()};return(e,a)=>{const l=b,n=w,Pe=E,We=C,Je=I,Me=R,Ne=V,Oe=k,Qe=x,Ye=D,Ze=z,ea=U,aa=A;return c(),i("div",H,[u("div",K,[u("div",L,[P,B.value?(c(),i("div",W,o(B.value),1)):r("",!0)]),u("div",J,[d(n,{type:"primary",onClick:Be,class:"batch-create-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(S))])),_:1}),h(" 批量创建 ")])),_:1}),d(n,{type:"success",onClick:Re,class:"batch-copy-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(S))])),_:1}),h(" 批量复制 ")])),_:1}),d(n,{type:"info",onClick:Se,class:"create-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(T))])),_:1}),h(" 新建通道 ")])),_:1})])]),u("div",M,[v((c(),_(Je,{data:j.value,stripe:"",class:"channels-table"},{default:p((()=>[d(Pe,{prop:"channel_name",label:"通道名称",width:"120"}),d(Pe,{prop:"visit_count",label:"通道访问量",width:"120",align:"center"}),d(Pe,{prop:"complaint_count",label:"通道投诉量",width:"120",align:"center"}),d(Pe,{label:"通道链接","min-width":"300"},{default:p((({row:e})=>[u("div",N,[u("span",O,o(e.channel_url),1),Q,d(n,{type:"primary",size:"small",onClick:a=>(async e=>{try{await navigator.clipboard.writeText(e),s.success("已复制到剪贴板")}catch(a){s.error("复制失败")}})(e.channel_url),class:"copy-btn"},{default:p((()=>[h(" 复制 ")])),_:2},1032,["onClick"])])])),_:1}),d(Pe,{prop:"status",label:"状态",width:"100",align:"center"},{default:p((({row:e})=>[d(We,{type:"enabled"===e.status?"success":"danger"},{default:p((()=>[h(o("enabled"===e.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),d(Pe,{label:"操作",width:"300",align:"center"},{default:p((({row:e})=>[d(n,{type:"primary",size:"small",onClick:a=>(e=>{Ce.id=e.id,Ce.channel_name=e.channel_name,Ce.description=e.description||"",Ce.status=e.status,be.value=!0})(e)},{default:p((()=>[h(" 编辑 ")])),_:2},1032,["onClick"]),d(n,{type:"enabled"===e.status?"danger":"success",size:"small",onClick:a=>(async e=>{try{const a="enabled"===e.status?"disabled":"enabled";await t.updateChannel(e.id,{status:a}),s.success("enabled"===a?"已启用":"已禁用"),je()}catch(a){s.error("操作失败: "+a.message)}})(e)},{default:p((()=>[h(o("enabled"===e.status?"禁用":"启用"),1)])),_:2},1032,["type","onClick"]),d(n,{type:"danger",size:"small",onClick:a=>(async e=>{try{await y.confirm(`确定要删除通道"${e.channel_name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await t.deleteChannel(e.id),s.success("删除成功"),je()}catch(a){"cancel"!==a&&s.error("删除失败: "+a.message)}})(e)},{default:p((()=>[h(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[aa,$.value]])]),u("div",Y,[d(Me,{"current-page":he.page,"onUpdate:currentPage":a[0]||(a[0]=e=>he.page=e),"page-size":he.pageSize,"onUpdate:pageSize":a[1]||(a[1]=e=>he.pageSize=e),"page-sizes":[10,20,50,100],total:he.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ke,onCurrentChange:Le},null,8,["current-page","page-size","total"])]),d(Ye,{modelValue:ve.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ve.value=e),title:"新建通道",width:"500px","before-close":Xe},{footer:p((()=>[d(n,{onClick:a[4]||(a[4]=e=>ve.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:Te,loading:_e.value},{default:p((()=>[h(" 创建 ")])),_:1},8,["loading"])])),default:p((()=>[d(Qe,{model:fe,rules:ge,ref_key:"createFormRef",ref:ye,"label-width":"100px"},{default:p((()=>[d(Oe,{label:"通道名称",prop:"channel_name"},{default:p((()=>[d(Ne,{modelValue:fe.channel_name,"onUpdate:modelValue":a[2]||(a[2]=e=>fe.channel_name=e),placeholder:"请输入通道名称"},null,8,["modelValue"])])),_:1}),d(Oe,{label:"通道描述",prop:"description"},{default:p((()=>[d(Ne,{modelValue:fe.description,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.description=e),type:"textarea",rows:3,placeholder:"请输入通道描述（可选）"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),d(Ye,{modelValue:be.value,"onUpdate:modelValue":a[10]||(a[10]=e=>be.value=e),title:"编辑通道",width:"500px","before-close":qe},{footer:p((()=>[d(n,{onClick:a[9]||(a[9]=e=>be.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:Fe,loading:we.value},{default:p((()=>[h(" 保存 ")])),_:1},8,["loading"])])),default:p((()=>[d(Qe,{model:Ce,rules:Ve,ref_key:"editFormRef",ref:ke,"label-width":"100px"},{default:p((()=>[d(Oe,{label:"通道名称",prop:"channel_name"},{default:p((()=>[d(Ne,{modelValue:Ce.channel_name,"onUpdate:modelValue":a[6]||(a[6]=e=>Ce.channel_name=e),placeholder:"请输入通道名称"},null,8,["modelValue"])])),_:1}),d(Oe,{label:"通道描述",prop:"description"},{default:p((()=>[d(Ne,{modelValue:Ce.description,"onUpdate:modelValue":a[7]||(a[7]=e=>Ce.description=e),type:"textarea",rows:3,placeholder:"请输入通道描述（可选）"},null,8,["modelValue"])])),_:1}),d(Oe,{label:"状态",prop:"status"},{default:p((()=>[d(ea,{modelValue:Ce.status,"onUpdate:modelValue":a[8]||(a[8]=e=>Ce.status=e),placeholder:"请选择状态"},{default:p((()=>[d(Ze,{label:"启用",value:"enabled"}),d(Ze,{label:"禁用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),d(Ye,{modelValue:xe.value,"onUpdate:modelValue":a[13]||(a[13]=e=>xe.value=e),title:"批量创建通道",width:"600px","before-close":Ie},{footer:p((()=>[d(n,{onClick:a[12]||(a[12]=e=>xe.value=!1)},{default:p((()=>[h("取消")])),_:1}),d(n,{type:"primary",onClick:Ee,loading:ze.value},{default:p((()=>[d(l,null,{default:p((()=>[d(m(S))])),_:1}),h(" 批量创建 ")])),_:1},8,["loading"])])),default:p((()=>[u("div",Z,[d(Oe,{label:"通道名称列表",required:""},{default:p((()=>[d(Ne,{modelValue:Ue.channel_names,"onUpdate:modelValue":a[11]||(a[11]=e=>Ue.channel_names=e),type:"textarea",rows:8,placeholder:"请输入通道名称,一行一个:\nXX员工姓名1\nXX员工姓名2\nXX员工姓名3"},null,8,["modelValue"])])),_:1}),u("div",ee,[d(l,null,{default:p((()=>[d(m(X))])),_:1}),ae]),u("div",le,[u("div",ne,[d(l,null,{default:p((()=>[d(m(X))])),_:1}),te]),se])])])),_:1},8,["modelValue"]),d(Ye,{modelValue:$e.value,"onUpdate:modelValue":a[15]||(a[15]=e=>$e.value=e),title:"批量复制通道信息",width:"600px","before-close":He},{footer:p((()=>[d(n,{onClick:a[14]||(a[14]=e=>$e.value=!1)},{default:p((()=>[h("关闭")])),_:1})])),default:p((()=>[u("div",ce,[u("div",ie,[d(n,{type:"primary",onClick:Ae,class:"copy-all-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(X))])),_:1}),h(" 复制全部通道信息 ")])),_:1}),d(n,{type:"success",onClick:De,class:"copy-names-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(F))])),_:1}),h(" 只复制名称 ")])),_:1}),d(n,{type:"warning",onClick:Ge,class:"copy-links-btn"},{default:p((()=>[d(l,null,{default:p((()=>[d(m(q))])),_:1}),h(" 只复制链接 ")])),_:1})]),ue,u("div",oe,[(c(!0),i(f,null,g(G.value,((e,a)=>(c(),i("div",{key:e.id,class:"channel-info-item"},[u("div",re,o(a+1)+". "+o(e.channel_name),1),u("div",de,o(e.channel_url),1)])))),128))]),u("div",pe,[d(l,null,{default:p((()=>[d(m(X))])),_:1}),me])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-daeae861"]]);export{he as default};
